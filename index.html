<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Content Editor</title>
        <link rel="stylesheet" href="style.css">
</head>
<body>

    <main>
        <h1>JS-Based Content Editor</h1>
        <p>This is a standard `textarea` that the script will turn into a rich content editor.</p>

        <textarea class="y-editor" name="content"></textarea>
    </main>

    <!-- <script src="https://cdn.jsdelivr.net/gh/yortem/yeditor@latest/dist/editor.min.js"></script> -->
     <script src="/src/editor.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const editorTextarea = document.querySelector('.y-editor');

            // Example of a custom button for multiple product selection
            yEditor.registerButton({
                title: 'Product List',
                icon: '<svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path d="M11 9h2V6h2V4h-2V1h-2v3H9v2h2v3zm-2 2H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2zM7 15H5v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2zM15 9h2V6h2V4h-2V1h-2v3h-2v2h2v3zm-8 2h2v2H7v-2zm-4 0h2v2H3v-2z"/></svg>',
                prompt: {
                    title: 'Add Products',
                    label: 'Search and add multiple products:',
                    placeholder: 'Type "phone" or "laptop"...',
                    displayField: 'title',
                    multiple: true,
                    search: async (query) => {
                        const mockProducts = [
                            { id: 101, title: 'iPhone 15 Pro', price: '$999' },
                            { id: 102, title: 'Samsung Galaxy S24', price: '$899' },
                            { id: 103, title: 'MacBook Air M3', price: '$1099' },
                            { id: 104, title: 'iPad Pro', price: '$799' }
                        ];
                        return mockProducts.filter(p => p.title.toLowerCase().includes(query.toLowerCase()));
                    },
                    renderItem: (item) => `
                        <div class="search-result-item" data-item='${JSON.stringify(item)}'>
                            <strong>${item.title}</strong>
                            <small>${item.price}</small>
                        </div>
                    `
                },
                onInsert: (selectedItems) => {
                    const ids = selectedItems.map(item => item.id).join(',');
                    return `<span class="y-products-block">{מוצרים: ${ids}}</span>`;
                },
                edit: {
                    selector: '.y-products-block',
                    onOpen: (element) => {
                        const match = element.textContent.match(/{מוצרים: (.*)}/);
                        if (match) {
                            const ids = match[1].split(',');
                            // In a real app, you might fetch full data for these IDs
                            // For this demo, we'll map them back to mock objects
                            return ids.map(id => ({ id: id.trim(), title: `Product ${id.trim()}` }));
                        }
                        return [];
                    }
                }
            });

            // Set initial example content
            editorTextarea.value = `
                <h2>Welcome to yEditor!</h2>
                <p>You can now manage product lists as non-editable shortcodes:</p>
                <p>Check this out: <span class="y-products-block" data-yeditor-block="true" data-yeditor-type="Product List" contenteditable="false" style="user-select: all;">{מוצרים: 101,102}</span></p>
                <p>Click the block above to edit the list (add or remove products).</p>
            `;

            // Initialize the editor
            yEditor.init('.y-editor', {
                lang: 'en',
                direction: 'ltr',
                theme: 'light',
                quickLinksApiUrl: 'links-api.json',
                imageGalleryApiUrl: 'images-api.json',
                fileBrowserUrl: 'file-browser.html' // Add the path to your file browser
            });

            // --- Example of listening to editor events ---
            const editorContainer = document.querySelector('.yeditor-container');

            editorContainer.addEventListener('yeditor-init', (e) => {
                console.log('Editor initialized!', e.detail);
            });

            editorContainer.addEventListener('yeditor-change', (e) => {
                console.log('Editor content changed:', e.detail.content);
            });

            editorContainer.addEventListener('yeditor-command-exec', (e) => {
                console.log(`Command executed: ${e.detail.command}`, e.detail.value || '');
            });
        });
    </script>

</body>
</html>
