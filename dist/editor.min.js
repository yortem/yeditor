(()=>{var k={_loadedTranslations:{},_defaultLang:"en",_cssContent:null,_scriptPath:null,_instances:{},_getToolbarButtons:function(){return[{command:"removeFormat",title:"removeFormat",icon:'<svg viewBox="0 0 24 24"><path d="M3.27 5L2 6.27l6.97 6.97L6.5 19h3l1.57-3.66L16.73 21l1.8-1.27L4.54 6.27.27 3.27zM6 5v.18L8.82 8h2.4l-.72 1.68 2.1 2.1L14.21 8H20V5z"/></svg>'},{command:"bold",title:"bold",icon:'<svg viewBox="0 0 16 16"><path d="M8.21 13c2.106 0 3.412-1.087 3.412-2.823 0-1.306-.984-2.283-2.324-2.386v-.055a2.176 2.176 0 0 0 1.852-2.14c0-1.51-1.162-2.46-3.014-2.46H3.843V13H8.21zM5.908 4.674h1.696c.963 0 1.517.451 1.517 1.244 0 .834-.629 1.32-1.73 1.32H5.908zm0 6.788V8.598h1.734c1.239 0 1.82.56 1.82 1.414 0 .933-.645 1.53-1.844 1.53H5.908z"/></svg>'},{command:"italic",title:"italic",icon:'<svg viewBox="0 0 24 24"><path d="M10 4v3h2.21l-3.42 8H6v3h8v-3h-2.21l3.42-8H18V4z"/></svg>'},{command:"underline",title:"underline",icon:'<svg viewBox="0 0 24 24"><path d="M12 17c3.31 0 6-2.69 6-6V3h-2.5v8c0 1.93-1.57 3.5-3.5 3.5S8.5 12.93 8.5 11V3H6v8c0 3.31 2.69 6 6 6zm-7 2v2h14v-2z"/></svg>'},{command:"createLink",title:"link",icon:'<svg viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"/></svg>'},{command:"unlink",title:"unlink",icon:'<svg viewBox="0 0 24 24"><path d="M17 7h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1 0 1.43-.98 2.63-2.31 2.96l1.46 1.46C20.88 15.61 22 13.95 22 12c0-2.76-2.24-5-5-5zM7 9h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1S5.29 9 7 9zm-1 4h10v-2H6zm-3.24-8.76L2 6.24l19.76 19.76 1.41-1.41z"/></svg>'},{command:"formatBlock",value:"blockquote",title:"quote",icon:'<svg viewBox="0 0 24 24"><path d="M6 17h3l2-4V7H5v6h3zm8 0h3l2-4V7h-6v6h3z"/></svg>'},{command:"insertTable",title:"table",icon:'<svg viewBox="0 0 24 24"><path d="M20 2H4c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM8 20H4v-4h4zm0-6H4v-4h4zm0-6H4V4h4zm6 12h-4v-4h4zm0-6h-4v-4h4zm0-6h-4V4h4zm6 12h-4v-4h4zm0-6h-4v-4h4zm0-6h-4V4h4z"/></svg>'},{command:"insertHorizontalRule",title:"horizontalRule",icon:'<svg viewBox="0 0 24 24"><path d="M4 11h16v2H4z"/></svg>'},{command:"insertImage",title:"insertImage",icon:'<svg viewBox="0 0 24 24"><path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5z"/></svg>'},{command:"insertUnorderedList",title:"unorderedList",icon:'<svg viewBox="0 0 24 24"><path d="M4 10.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm0-6c-.83 0-1.5.67-1.5 1.5S3.17 7.5 4 7.5 5.5 6.83 5.5 6 4.83 4.5 4 4.5zm0 12c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zM7 19h14v-2H7zm0-6h14v-2H7zm0-8v2h14V5z"/></svg>'},{command:"insertOrderedList",title:"orderedList",icon:'<svg viewBox="0 0 24 24"><path d="M2 17h2v.5H3v1h1v.5H2v1h3v-4H2zm1-9h1V4H2v1h1zm-1 3h1.8L2 13.1v.9h3v-1H3.2L5 10.9V10H2zm5-6v2h14V5zm0 14h14v-2H7zm0-6h14v-2H7z"/></svg>'},{command:"toggleSource",title:"source",icon:'<svg viewBox="0 0 24 24"><path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"/></svg>'}]},init:async function(e,n={}){let o={lang:"en",direction:"ltr",theme:"light",quickLinksApiUrl:null,imageGalleryApiUrl:null,fileBrowserOptions:{},fileBrowserUrl:null,...n};this.config=o;let t=document.querySelector(e);if(!t){console.error("yEditor: Element not found for selector:",e);return}if(t.style.visibility="hidden",!this._scriptPath){let m=document.querySelector('script[src*="editor.js"], script[src*="editor.min.js"]');if(m){let y=m.src;this._scriptPath=y.substring(0,y.lastIndexOf("/"))}else this._scriptPath=".",console.warn("yEditor: Could not determine script path. Assuming assets are relative to the HTML document.")}await Promise.all([this._ensureDOMPurify(),this._loadCSS(),this._loadLanguage(o.lang)]),this.t=m=>this._loadedTranslations[this.config.lang]?.[m]||this._loadedTranslations[this._defaultLang]?.[m]||m,t.style.display="none";let i=document.createElement("div");i.className="yeditor-container",i.dataset.theme=o.theme,i.dir=o.direction;let l=i.attachShadow({mode:"open"});this._container=i,this._shadowRoot=l,this._textarea=t,this._instances[e]={container:i,shadowRoot:l,textarea:t};let s=document.createElement("style");s.textContent=this._cssContent,l.appendChild(s);let a=this.createToolbar(),h=this.createContentArea(t.value,o.direction);this._protectBlocks(h);let r=document.createElement("textarea");r.className="yeditor-source",r.style.display="none",r.dir="ltr",l.appendChild(a),l.appendChild(h),l.appendChild(r);let p=document.createElement("div");p.className="yeditor-statusbar",p.innerHTML=`
            <div class="yeditor-dom-path"></div>
            <div class="yeditor-word-count"></div>
        `,l.appendChild(p),t.parentNode.insertBefore(i,t),this.setupEventListeners(l,a,h,r,t,i),document.addEventListener("click",m=>{!i.contains(m.target)&&!m.composedPath().includes(i)&&(this.hideLinkToolbar(l),this.hideTableToolbar(l),this._customButtons.forEach(y=>{if(y.edit){let f=l.querySelector(`[data-bubble-for="${y.edit.selector}"]`);f&&f.remove()}}))}),this._listenForExternalContent(),t.classList.add("yeditor-initialized"),this._dispatchEvent("yeditor-init",{editor:i})},getInstance:function(e){return this._instances[e]},setContent:function(e,n){let o=this._instances[e];if(!o){console.error(`yEditor: No editor instance found for selector "${e}". Was it initialized?`);return}let{shadowRoot:t,textarea:i}=o,l=t.querySelector(".yeditor-content");if(!l)return;let s=DOMPurify.sanitize(n,{ADD_ATTR:["style","contenteditable","data-yeditor-block","data-yeditor-type","data-yeditor-resizable"],ADD_TAGS:["div","span"]});l.innerHTML=s,this._protectBlocks(l),l.dispatchEvent(new Event("input",{bubbles:!0,cancelable:!0}))},_listenForExternalContent:function(){this._isListeningForExternalContent||(document.addEventListener("yeditor-set-content",e=>{this.setContent(e.detail.selector,e.detail.content)}),this._isListeningForExternalContent=!0)},_loadCSS:async function(){if(this._cssContent)return;let e=`${this._scriptPath}/editor.min.css`,n;try{if(n=await fetch(e),n.ok||(e=`${this._scriptPath}/editor.css`,n=await fetch(e)),!n.ok)throw new Error(`Neither editor.min.css nor editor.css were found at ${this._scriptPath}`);this._cssContent=await n.text()}catch(o){console.error("yEditor: Failed to load CSS.",o)}},_ensureDOMPurify:function(){return new Promise((e,n)=>{if(window.DOMPurify)return e();let o=document.createElement("script");o.src="https://cdn.jsdelivr.net/npm/dompurify@3.0.11/dist/purify.min.js",o.onload=()=>{e()},o.onerror=()=>n(new Error("yEditor: Failed to load DOMPurify from CDN.")),document.head.appendChild(o)})},_loadLanguage:async function(e){if(!this._loadedTranslations[e])try{let n=`${this._scriptPath}/lang/${e}.json`,o=await fetch(n);if(!o.ok)throw new Error(`Language file not found: ${e}.json`);this._loadedTranslations[e]=await o.json()}catch(n){console.error(`yEditor: Failed to load language '${e}'. Falling back to default.`,n),e!==this._defaultLang&&await this._loadLanguage(this._defaultLang)}},createToolbar:function(){let e=document.createElement("div");e.className="yeditor-toolbar";let n={[this.t("paragraph")||"Paragraph"]:"p",[this.t("heading1")||"Heading 1"]:"h1",[this.t("heading2")||"Heading 2"]:"h2",[this.t("heading3")||"Heading 3"]:"h3",[this.t("heading4")||"Heading 4"]:"h4",[this.t("heading5")||"Heading 5"]:"h5",[this.t("heading6")||"Heading 6"]:"h6"},o=document.createElement("div");o.className="yeditor-dropdown";let t=document.createElement("button");t.innerHTML=this.t("headings")||"Headings",t.style.width="auto",t.style.padding="0 10px";let i=document.createElement("div");i.className="yeditor-dropdown-content";for(let[u,c]of Object.entries(n)){let b=document.createElement("button");b.dataset.command="formatBlock",b.dataset.value=c,b.textContent=u,i.appendChild(b)}o.append(t,i),e.appendChild(o),this._getToolbarButtons().forEach(u=>{let c=document.createElement("button");c.type="button",c.dataset.command=u.command,u.value&&(c.dataset.value=u.value),c.title=this.t(u.title),c.innerHTML=u.icon,e.appendChild(c)});let s=["#000000","#6c757d","#dc3545","#fd7e14","#ffc107","#28a745","#17a2b8","#007bff","#6f42c1","#e83e8c","#adb5bd","#ffffff"],a=document.createElement("div");a.className="yeditor-dropdown";let h=document.createElement("button");h.title=this.t("textColor"),h.innerHTML='<svg viewBox="0 0 24 24"><path d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9c.83 0 1.5-.67 1.5-1.5 0-.39-.15-.74-.39-1.01-.23-.26-.38-.61-.38-.99 0-.83.67-1.5 1.5-1.5H16c2.76 0 5-2.24 5-5 0-4.42-4.03-8-9-8zM6.5 12c-.83 0-1.5-.67-1.5-1.5S5.67 9 6.5 9 8 9.67 8 10.5 7.33 12 6.5 12zm3-4C8.67 8 8 7.33 8 6.5S8.67 5 9.5 5s1.5.67 1.5 1.5S10.33 8 9.5 8zm5 0c-.83 0-1.5-.67-1.5-1.5S13.67 5 14.5 5s1.5.67 1.5 1.5S15.33 8 14.5 8zm3 4c-.83 0-1.5-.67-1.5-1.5S16.67 9 17.5 9s1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"/></svg>';let r=document.createElement("div");r.className="yeditor-dropdown-content yeditor-color-grid",s.forEach(u=>{let c=document.createElement("button");c.className="yeditor-color-swatch",c.dataset.command="foreColor",c.dataset.value=u,c.style.backgroundColor=u,c.title=u,r.appendChild(c)}),a.append(h,r),e.appendChild(a);let p={justifyLeft:{title:"alignLeft",icon:'<svg viewBox="0 0 24 24"><path d="M15 15H3v2h12zm0-8H3v2h12zM3 13h18v-2H3zm0 8h18v-2H3zM3 3v2h18V3z"/></svg>'},justifyCenter:{title:"alignCenter",icon:'<svg viewBox="0 0 24 24"><path d="M7 15v2h10v-2zm-4 6h18v-2H3zm0-8h18v-2H3zm4-6v2h10V7zM3 3v2h18V3z"/></svg>'},justifyRight:{title:"alignRight",icon:'<svg viewBox="0 0 24 24"><path d="M3 21h18v-2H3zm6-4h12v-2H9zM3 13h18v-2H3zm6-4h12V7H9zM3 3v2h18V3z"/></svg>'}},m=document.createElement("div");m.className="yeditor-dropdown",m.dataset.group="align";let y=document.createElement("button"),f=this.config.direction==="rtl"?"justifyRight":"justifyLeft";y.innerHTML=p[f].icon,y.title=this.t(p[f].title);let d=document.createElement("div");return d.className="yeditor-dropdown-content",Object.entries(p).forEach(([u,c])=>{let b=document.createElement("button");b.dataset.command=u,b.title=this.t(c.title),b.innerHTML=c.icon,d.appendChild(b)}),m.append(y,d),e.appendChild(m),this._addCustomButtons(e),[{command:"setDirection",value:"ltr",title:"setDirectionLtr",icon:'<svg viewBox="0 0 24 24"><path d="M9 10v5h2V4h2v11h2V4h2V2H9C6.79 2 5 3.79 5 6s1.79 4 4 4zm12 8-4-4v3H5v2h12v3z"/></svg>'},{command:"setDirection",value:"rtl",title:"setDirectionRtl",icon:'<svg viewBox="0 0 24 24"><path d="M10 10v5h2V4h2v11h2V4h2V2h-8C7.79 2 6 3.79 6 6s1.79 4 4 4zm-2 7v-3l-4 4 4 4v-3h12v-2z"/></svg>'}].forEach(u=>{let c=document.createElement("button");c.type="button",c.dataset.command=u.command,c.dataset.value=u.value,c.title=this.t(u.title),c.innerHTML=u.icon,e.appendChild(c)}),e},createContentArea:function(e,n){let o=document.createElement("div");return o.className="yeditor-content",o.contentEditable=!0,o.dir=n,o.innerHTML=DOMPurify.sanitize(e,{ADD_ATTR:["style","contenteditable","data-yeditor-block","data-yeditor-type","data-yeditor-resizable"],ADD_TAGS:["div","span"]}),o},setupEventListeners:function(e,n,o,t,i,l){e.addEventListener("click",s=>{s.target.closest(".yeditor-dropdown > button")||e.querySelectorAll(".yeditor-dropdown.active").forEach(a=>a.classList.remove("active"))}),n.addEventListener("click",s=>{let a=s.target.closest(".yeditor-dropdown");a&&(a.classList.toggle("active"),e.querySelectorAll(".yeditor-dropdown").forEach(d=>{d!==a&&d.classList.remove("active")}));let h=s.target.closest("button[data-command]");if(!h)return;this._dispatchEvent("yeditor-command-exec",{command:h.dataset.command,value:h.dataset.value});let{command:r,value:p}=h.dataset,m=h.closest(".yeditor-dropdown");m&&m.classList.remove("active");let y=e.getSelection?e.getSelection():window.getSelection(),f=y.rangeCount>0?y.getRangeAt(0):null;if(r==="createLink"){let d=f?f.startContainer.parentElement.closest("a"):null;if(d){let v={url:d.href,newWindow:d.target==="_blank"};this.showLinkPrompt(e,v).then(u=>{u&&(d.href=u.url,u.newWindow?d.target="_blank":d.removeAttribute("target"))})}else{if(!f||f.collapsed){this.showAlert(e,this.t("linkTextRequired"));return}this.showLinkPrompt(e).then(v=>{if(v&&f){y.removeAllRanges(),y.addRange(f),document.execCommand("createLink",!1,v.url);let u=y.anchorNode.parentElement.closest("a");u&&v.newWindow&&u.setAttribute("target","_blank")}})}}else if(r==="insertTable"){this.showTablePrompt(e).then(d=>{if(d&&f){y.removeAllRanges(),y.addRange(f);let v=this._createTableHTML(d.rows,d.cols);document.execCommand("insertHTML",!1,v)}});return}else if(r==="insertImage"){this.showImagePrompt(e).then(d=>{if(d&&d.url&&f){y.removeAllRanges(),y.addRange(f);let v=DOMPurify.sanitize(d.alt,{USE_PROFILES:{html:!1}});document.execCommand("insertHTML",!1,`<img src="${d.url}" alt="${v}">`)}});return}else if(r==="formatBlock"&&p==="blockquote")(f?f.startContainer.parentElement.closest("blockquote"):null)?document.execCommand("formatBlock",!1,"p"):document.execCommand("formatBlock",!1,"blockquote");else if(r==="setDirection")this.setBlockDirection(e,p);else if(r==="toggleSource"){let d=e.querySelector(".yeditor-content"),v=e.querySelector(".yeditor-source");if(v.style.display!=="none")d.innerHTML=DOMPurify.sanitize(v.value,{ADD_ATTR:["style","contenteditable","data-yeditor-block","data-yeditor-type","data-yeditor-resizable"],ADD_TAGS:["div","span"]}),this._protectBlocks(d),v.style.display="none",d.style.display="block",h.classList.remove("active"),i.value=this._cleanHTML(d.innerHTML),this._dispatchEvent("yeditor-change",{content:i.value}),this.updateDomPath(e,d),this.updateWordCount(e,d),n.querySelectorAll("button[data-command], .yeditor-dropdown").forEach(c=>{c!==h&&!c.closest(".yeditor-dropdown")&&(c.classList.remove("disabled"),c.style.pointerEvents="auto"),c.classList.contains("yeditor-dropdown")&&(c.style.pointerEvents="auto",c.style.opacity="1")});else{v.value=this._cleanHTML(d.innerHTML),d.style.display="none",v.style.display="block",h.classList.add("active"),i.value=v.value;let c=e.querySelector(".yeditor-dom-path");c&&(c.innerHTML=""),this.updateWordCount(e,v),n.querySelectorAll("button[data-command], .yeditor-dropdown").forEach(b=>{b!==h&&!b.closest(".yeditor-dropdown")&&(b.classList.add("disabled"),b.style.pointerEvents="none"),b.classList.contains("yeditor-dropdown")&&(b.style.pointerEvents="none",b.style.opacity="0.4")})}return}else document.execCommand(r,!1,p||null);o.focus()}),o.addEventListener("input",()=>{i.value=this._cleanHTML(o.innerHTML),this._dispatchEvent("yeditor-change",{content:i.value}),this.updateDomPath(e,o),this.updateWordCount(e,o)}),t.addEventListener("input",()=>{i.value=t.value,this._dispatchEvent("yeditor-change",{content:i.value}),this.updateWordCount(e,t)}),o.addEventListener("paste",s=>{s.preventDefault();let a=s.clipboardData||window.clipboardData,h=a.getData("text/html"),r=a.getData("text/plain");if(h){let p=DOMPurify.sanitize(h,{ALLOWED_TAGS:["p","br","h1","h2","h3","h4","h5","h6","ul","ol","li","a","b","i","u","strong","em","blockquote","table","thead","tbody","tr","th","td","img","hr"],ALLOWED_ATTR:["href","target","src","alt","dir"]});document.execCommand("insertHTML",!1,p)}else document.execCommand("insertText",!1,r)}),e.addEventListener("selectionchange",()=>{this.updateDomPath(e,o)}),o.addEventListener("click",s=>{this.updateDomPath(e,o);let a=s.target.closest("a"),h=s.target.closest("table"),r=s.target.closest("img");a?(this.showLinkToolbar(e,a),s.preventDefault()):this.hideLinkToolbar(e),h?this.showTableToolbar(e,h):this.hideTableToolbar(e),r?this._handleImageSelection(e,r):this._clearImageSelection(e),this._customButtons.forEach(p=>{if(p.edit){let m=s.target.closest(p.edit.selector);m&&this._showCustomBubble(e,m,p)}})}),this.updateWordCount(e,o),this.updateDomPath(e,o),o.addEventListener("keyup",s=>{(s.key===" "||s.code==="Space")&&this._handleMarkdown(e)}),o.addEventListener("keydown",s=>{s.key==="Tab"&&this._handleTabInTable(s)}),o.addEventListener("focus",()=>{this._dispatchEvent("yeditor-focus")}),o.addEventListener("blur",()=>{this._dispatchEvent("yeditor-blur")})},showAlert:function(e,n){let o=document.createElement("p");o.textContent=n;let t=document.createElement("div"),i=document.createElement("button");i.textContent=this.t("ok"),i.className="active",t.appendChild(i);let l=this._createModal(this.t("alertTitle"),o,t);requestAnimationFrame(()=>i.focus()),i.onclick=()=>l.remove()},showTablePrompt:function(e,n={}){return new Promise(o=>{let t=document.createElement("div");t.innerHTML=`
                <div class="input-group">
                    <div>
                        <label for="table-rows">${this.t("rows")}</label>
                        <input type="number" id="table-rows" min="1">
                    </div>
                    <div>
                        <label for="table-cols">${this.t("columns")}</label>
                        <input type="number" id="table-cols" min="1">
                    </div>
                </div>
                <div class="checkbox-container">
                    <input type="checkbox" id="table-header">
                    <label for="table-header">${this.t("headerRow")}</label>
                </div>
            `;let i=document.createElement("div"),l=document.createElement("button");l.textContent=this.t("cancel");let s=document.createElement("button");s.textContent=this.t("ok"),s.className="active",i.append(l,s);let a=this._createModal(this.t("table"),t,i),h=t.querySelector("#table-rows"),r=t.querySelector("#table-cols"),p=t.querySelector("#table-header");h.value=n.rows||2,r.value=n.cols||2,p.checked=n.header||!1,requestAnimationFrame(()=>h.focus()),[h,r].forEach(m=>{m.addEventListener("keydown",y=>{y.key==="Enter"&&(y.preventDefault(),s.click())})}),s.onclick=()=>{a.remove(),o({rows:parseInt(h.value,10),cols:parseInt(r.value,10),header:p.checked})},l.onclick=()=>{a.remove(),o(null)}})},showImagePrompt:function(e,n={}){return new Promise(o=>{let t=document.createElement("div");t.innerHTML=`
                <div class="yeditor-modal-tabs">
                    <button class="active" data-tab="url">${this.t("fromUrl")}</button>
                    <button data-tab="gallery">${this.t("fromGallery")}</button>
                </div>
                <div id="tab-url" class="yeditor-modal-tab-content active">
                    <label for="image-url">${this.t("linkUrlLabel")}</label>
                    <div class="input-with-button">
                        <input type="text" id="image-url" placeholder="https://..." value="${n.url||""}">
                        <button type="button" id="yeditor-browse-server" class="yeditor-browse-button">${this.t("browseServer")}</button>
                    </div>
                </div>
                <div id="tab-gallery" class="yeditor-modal-tab-content">
                    <div class="image-gallery"></div>
                </div>
                <div style="margin-top: 15px;">
                    <label for="image-alt">${this.t("altText")}</label>
                    <input type="text" id="image-alt" value="${n.alt||""}">
                </div>
            `;let i=document.createElement("div"),l=document.createElement("button");l.textContent=this.t("cancel");let s=document.createElement("button");s.textContent=this.t("ok"),s.className="active",i.append(l,s);let a=this._createModal(this.t("insertImage"),t,i);requestAnimationFrame(()=>t.querySelector("#image-url").focus());let h=t.querySelector("#image-url"),r=t.querySelector("#image-alt"),p=t.querySelector("#yeditor-browse-server");this.config.fileBrowserUrl?p.addEventListener("click",()=>{window.yEditorFileBrowserCallback=g=>{g&&(h.value=g),delete window.yEditorFileBrowserCallback};let u=this.config.fileBrowserOptions||{},c=u.width||900,b=u.height||600,w=u.left!==void 0?u.left:(window.screen.width-c)/2,L=u.top!==void 0?u.top:(window.screen.height-b)/2;window.open(this.config.fileBrowserUrl,"yEditorFileBrowser",`width=${c},height=${b},left=${w},top=${L},resizable=yes,scrollbars=yes`)}):p.style.display="none",[h,r].forEach(u=>{u.addEventListener("keydown",c=>{c.key==="Enter"&&(c.preventDefault(),s.click())})});let m=t.querySelectorAll(".yeditor-modal-tabs button"),y=t.querySelectorAll(".yeditor-modal-tab-content");m.forEach(u=>{u.addEventListener("click",()=>{m.forEach(c=>c.classList.remove("active")),u.classList.add("active"),y.forEach(c=>c.classList.remove("active")),t.querySelector(`#tab-${u.dataset.tab}`).classList.add("active")})});let f=t.querySelector(".image-gallery"),d=t.querySelector('button[data-tab="gallery"]');this.config.imageGalleryApiUrl?fetch(this.config.imageGalleryApiUrl).then(u=>u.json()).then(u=>{f.innerHTML=u.map(c=>`
                            <div class="image-gallery-item" data-url="${c.url}" data-title="${c.title}">
                                <img src="${c.url}" alt="${c.title}">
                            </div>
                        `).join("")}):d.style.display="none";let v="";f.addEventListener("click",u=>{let c=u.target.closest(".image-gallery-item");c&&(f.querySelectorAll(".image-gallery-item").forEach(b=>b.classList.remove("selected")),c.classList.add("selected"),v=c.dataset.url,t.querySelector("#image-alt").value=c.dataset.title)}),s.onclick=()=>{let c=t.querySelector(".yeditor-modal-tabs button.active").dataset.tab==="gallery"?v:t.querySelector("#image-url").value,b=t.querySelector("#image-alt").value;a.remove(),o({url:c,alt:b})},l.onclick=()=>{a.remove(),o(null)}})},showLinkPrompt:function(e,n={}){return new Promise(o=>{let t=this.config.quickLinksApiUrl?this.t("linkPlaceholder"):this.t("linkPlaceholderSimple"),i=document.createElement("div");i.innerHTML=`
                <label for="link-url">${this.t("linkUrlLabel")}</label>
                <input type="text" id="link-url" placeholder="${t}" autocomplete="off">
                <div class="search-results"></div>
                <div class="checkbox-container">
                    <input type="checkbox" id="link-new-window">
                    <label for="link-new-window">${this.t("linkNewWindowLabel")}</label>
                </div>
            `;let l=document.createElement("div"),s=document.createElement("button");s.textContent=this.t("cancel");let a=document.createElement("button");a.textContent=this.t("ok"),a.className="active",l.append(s,a);let h=this._createModal(this.t("linkPromptTitle"),i,l),r=i.querySelector("#link-url"),p=i.querySelector("#link-new-window"),m=i.querySelector(".search-results");r.value=n.url||"",p.checked=n.newWindow||!1,requestAnimationFrame(()=>{r.focus(),r.select()});let y=f=>{h.remove(),o(f)};if(a.onclick=()=>y({url:r.value,newWindow:p.checked}),s.onclick=()=>y(null),r.addEventListener("keydown",f=>{if(f.key==="Enter"){f.preventDefault();let v=m.querySelector(".selected");v?v.click():a.click();return}let d=m.querySelectorAll(".search-result-item");if(d.length>0&&(f.key==="ArrowDown"||f.key==="ArrowUp")){f.preventDefault();let v=m.querySelector(".selected"),u=-1;v&&(u=Array.from(d).indexOf(v),v.classList.remove("selected"));let c;f.key==="ArrowDown"?c=(u+1)%d.length:c=(u-1+d.length)%d.length;let b=d[c];b&&(b.classList.add("selected"),b.scrollIntoView({block:"nearest"}))}}),this.config.quickLinksApiUrl){let f;r.addEventListener("input",()=>{clearTimeout(f),f=setTimeout(async()=>{let d=r.value.trim().toLowerCase();if(d.length<2){m.innerHTML="";return}try{let c=(await(await fetch(this.config.quickLinksApiUrl)).json()).filter(b=>b.title.toLowerCase().includes(d)||b.url.toLowerCase().includes(d));m.innerHTML=c.map(b=>`<a class="search-result-item" data-url="${b.url}">
                                    ${b.title}
                                    <small>${b.url}</small>
                                </a>`).join("")}catch(v){console.error("Quick links API error:",v)}},300)})}m.addEventListener("click",f=>{let d=f.target.closest(".search-result-item");d&&(r.value=d.dataset.url,m.innerHTML="",r.focus())})})},_createModal:function(e,n,o){let t=document.createElement("div");t.className="yeditor-modal-overlay";let i=document.createElement("div");i.className="yeditor-modal";let l=document.createElement("div");l.className="yeditor-modal-header",l.textContent=e;let s=document.createElement("div");s.className="yeditor-modal-body",s.appendChild(n);let a=document.createElement("div");return a.className="yeditor-modal-footer",a.appendChild(o),i.append(l,s,a),t.appendChild(i),this._injectModalStyles(),document.body.appendChild(t),requestAnimationFrame(()=>t.classList.add("active")),t},_createTableHTML:function(e,n,o){let t="<table>";if(o){t+="<thead><tr>";for(let i=0;i<n;i++)t+="<th>&nbsp;</th>";t+="</tr></thead>",e--}if(t+="<tbody>",e>0)for(let i=0;i<e;i++){t+="<tr>";for(let l=0;l<n;l++)t+="<td>&nbsp;</td>";t+="</tr>"}return t+="</tbody></table><p><br></p>",t},_injectModalStyles:function(){if(document.getElementById("yeditor-modal-styles"))return;let e=document.createElement("style");e.id="yeditor-modal-styles";let n=this._cssContent.substring(this._cssContent.indexOf("/* --- Modal (Popup) Styles --- */"));e.textContent=n.replace(/:host\(\[data-theme="dark"\]\)/g,'body[data-yeditor-theme="dark"]'),document.head.appendChild(e)},showLinkToolbar:function(e,n){this.hideLinkToolbar(e);let o=document.createElement("div");o.className="link-toolbar";let t=document.createElement("a");t.href=n.href,t.textContent=n.href,t.target="_blank",t.rel="noopener noreferrer";let i=document.createElement("button");i.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>',i.title=this.t("linkPromptTitle");let l=document.createElement("button");l.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M16 13h-2.55v-2H16v2zm-6.45 0H7v-2h2.55v2zM17 7h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1 0 1.43-.98 2.63-2.31 2.96l1.46 1.46C20.88 15.61 22 13.95 22 12c0-2.76-2.24-5-5-5zM7 9h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1S5.29 9 7 9zm5 10c2.76 0 5-2.24 5-5h-1.9c0 1.71-1.39 3.1-3.1 3.1s-3.1-1.39-3.1-3.1H7c0 2.76 2.24 5 5 5z"/><path d="M3.41 4.83L2 6.24l18 18 1.41-1.41z"/></svg>',l.title=this.t("unlink"),o.append(t,i,l),e.appendChild(o),requestAnimationFrame(()=>{let s=n.getBoundingClientRect(),a=e.host.getBoundingClientRect(),h=o.offsetHeight,r=o.offsetWidth,p=s.top-a.top-h-5,m=s.left-a.left+s.width/2;m-r/2<0?m=r/2+5:m+r/2>a.width&&(m=a.width-r/2-5),o.style.top=`${p}px`,o.style.left=`${m}px`,o.classList.add("active")}),i.onclick=()=>{let s={url:n.href,newWindow:n.target==="_blank"};this.showLinkPrompt(e,s).then(a=>{a&&(n.href=a.url,a.newWindow?n.target="_blank":n.removeAttribute("target"))}),this.hideLinkToolbar(e)},l.onclick=()=>{let s=e.getSelection?e.getSelection():window.getSelection(),a=document.createRange();a.selectNode(n),s.removeAllRanges(),s.addRange(a),document.execCommand("unlink",!1,null),this.hideLinkToolbar(e)}},hideLinkToolbar:function(e){let n=e.querySelector(".link-toolbar");n&&n.remove()},showTableToolbar:function(e,n){this.hideTableToolbar(e);let o=document.createElement("div");o.className="table-toolbar";let t=document.createElement("button");t.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M22 13h-8v-2h8v2zm0-6h-8v2h8V7zm-8 10h8v-2h-8v2zM12 7v10H4V7h8zm-2 8H6v-2h4v2zm0-4H6v-2h4v2z"/></svg>',t.title=this.t("addRow");let i=document.createElement("button");i.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>',i.title=this.t("editTable"),o.append(i,t),e.appendChild(o),requestAnimationFrame(()=>{let l=n.getBoundingClientRect(),s=e.host.getBoundingClientRect(),a=o.offsetHeight,h=o.offsetWidth,r=l.top-s.top-a-5,p=l.left-s.left+l.width/2;p-h/2<0?p=h/2+5:p+h/2>s.width&&(p=s.width-h/2-5),o.style.top=`${r}px`,o.style.left=`${p}px`,o.classList.add("active")}),t.onclick=()=>{let l=n.querySelector("tbody");if(!l)return;let s=l.insertRow(-1),a=n.rows[0]?.cells.length||1;for(let h=0;h<a;h++)s.insertCell(h).innerHTML="&nbsp;"},i.onclick=()=>{let l={rows:n.rows.length,cols:n.rows[0]?.cells.length||0,header:!!n.querySelector("thead")};this.showTablePrompt(e,l).then(s=>{if(s){let a=this._createTableHTML(s.rows,s.cols,s.header),h=document.createElement("div");h.innerHTML=a;let r=DOMPurify.sanitize(h.innerHTML,{ADD_TAGS:["table","thead","tbody","tr","th","td"],ADD_ATTR:["style","border"]});n.parentNode.replaceChild(r,n)}}),this.hideTableToolbar(e)}},hideTableToolbar:function(e){let n=e.querySelector(".table-toolbar");n&&n.remove()},_handleImageSelection:function(e,n){this._clearImageSelection(e);let o=n.parentElement;o.classList.contains("yeditor-image-wrapper")||(o=document.createElement("span"),o.className="yeditor-image-wrapper",n.parentNode.insertBefore(o,n),o.appendChild(n)),o.classList.add("resizable"),o.style.width=`${n.offsetWidth}px`,o.style.height=`${n.offsetHeight}px`,this.showImageToolbar(e,o,n);let t=()=>{n.style.width=o.style.width,n.style.height=o.style.height,o.classList.remove("resizable"),this._textarea.value=DOMPurify.sanitize(o.closest(".yeditor-content").innerHTML),o.classList.add("resizable"),document.removeEventListener("mouseup",t)};document.addEventListener("mouseup",t)},_clearImageSelection:function(e){e.querySelectorAll(".yeditor-image-wrapper.resizable").forEach(n=>{n.classList.remove("resizable")}),this.hideImageToolbar(e)},showImageToolbar:function(e,n,o){this.hideImageToolbar(e);let t=document.createElement("div");t.className="image-toolbar";let i=document.createElement("button");i.innerHTML='<svg viewBox="0 0 24 24"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.996.996 0 0 0-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>',i.title=this.t("editImage");let l=document.createElement("button");l.innerHTML='<svg viewBox="0 0 24 24"><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"/></svg>',l.title=this.t("deleteImage"),t.append(i,l),e.appendChild(t),requestAnimationFrame(()=>{let s=n.getBoundingClientRect(),a=e.host.getBoundingClientRect(),h=t.offsetHeight,r=t.offsetWidth,p=s.top-a.top-h-5,m=s.left-a.left+s.width/2;m-r/2<0?m=r/2+5:m+r/2>a.width&&(m=a.width-r/2-5),t.style.top=`${p}px`,t.style.left=`${m}px`,t.classList.add("active")}),i.onclick=()=>{this.showImagePrompt(e,{url:o.src,alt:o.alt}).then(s=>{s&&(o.src=s.url,o.alt=s.alt)})},l.onclick=()=>{n.remove(),this.hideImageToolbar(e),e.querySelector(".yeditor-content").dispatchEvent(new Event("input",{bubbles:!0,cancelable:!0}))}},hideImageToolbar:function(e){let n=e.querySelector(".image-toolbar");n&&n.remove()},_handleTabInTable:function(e){let n=this._shadowRoot.getSelection();if(!n||!n.rangeCount)return;let o=n.anchorNode.parentElement.closest("td, th");if(!o)return;e.preventDefault();let t=o.closest("table"),i=Array.from(t.querySelectorAll("td, th")),l=i.indexOf(o),s;if(e.shiftKey){if(s=l-1,s<0)return}else if(s=l+1,s>=i.length){let r=(t.querySelector("tbody")||t).insertRow(-1),p=o.parentElement.cells.length;for(let m=0;m<p;m++)r.insertCell(m).innerHTML="&nbsp;";this._focusCell(r.cells[0]);return}let a=i[s];a&&this._focusCell(a)},_focusCell:function(e){let n=document.createRange(),o=this._shadowRoot.getSelection();n.selectNodeContents(e),o.removeAllRanges(),o.addRange(n)},_handleMarkdown:function(e){let n=e.getSelection();if(!n||!n.rangeCount)return;let o=n.getRangeAt(0),t=o.startContainer;if(t.nodeType!==Node.TEXT_NODE||o.startOffset<2)return;let i=t.parentElement;if(i.tagName!=="P"&&!i.tagName.startsWith("H"))return;let s=t.textContent.substring(0,o.startOffset).match(/^(#{1,6})\s$/);if(s){let h=`h${s[1].length}`,r=document.createRange();r.setStart(t,0),r.setEnd(t,s[0].length),n.removeAllRanges(),n.addRange(r),document.execCommand("insertText",!1,""),document.execCommand("formatBlock",!1,h)}},updateWordCount:function(e,n){let o=e.querySelector(".yeditor-word-count");if(!o)return;let l=((n.tagName==="TEXTAREA"?n.value:n.innerText)||"").trim().split(/\s+/).filter(Boolean).length;o.textContent=`${this.t("words")||"Words"}: ${l}`},updateDomPath:function(e,n){let o=e.querySelector(".yeditor-dom-path");if(!o)return;let t=e.getSelection?e.getSelection():window.getSelection();if(!t||t.rangeCount===0)return;let i=t.anchorNode,l=[],s=[];for(;i&&i!==n;)i.nodeType===Node.ELEMENT_NODE&&s.unshift(i),i=i.parentNode;o.innerHTML="",s.forEach((a,h)=>{let r=document.createElement("span");r.textContent=a.tagName.toLowerCase(),r.style.cursor="pointer",r.addEventListener("click",p=>{p.preventDefault(),p.stopPropagation();let m=document.createRange(),y=e.getSelection?e.getSelection():window.getSelection();m.selectNode(a),y.removeAllRanges(),y.addRange(m),n.focus()}),o.appendChild(r)})},setBlockDirection:function(e,n){let o=e.getSelection?e.getSelection():window.getSelection();if(!o.rangeCount)return;let i=o.getRangeAt(0).startContainer;for(;i&&(!i.style||window.getComputedStyle(i).display!=="block");)i=i.parentNode;i&&i.style&&(i.setAttribute("dir",n),i.style.textAlign=n==="rtl"?"right":"left")},_showCustomBubble:function(e,n,o){e.querySelectorAll("[data-bubble-for]").forEach(l=>l.remove());let t=document.createElement("div");t.className="link-toolbar",t.dataset.bubbleFor=o.edit.selector;let i=document.createElement("button");i.innerHTML='<svg viewBox="0 0 24 24"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.996.996 0 0 0-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>',i.title=o.prompt.title,t.appendChild(i),e.appendChild(t),requestAnimationFrame(()=>{let l=n.getBoundingClientRect(),s=e.host.getBoundingClientRect();t.style.top=`${l.top-s.top-t.offsetHeight-5}px`,t.style.left=`${l.left-s.left+l.width/2}px`,t.classList.add("active")}),i.onclick=()=>{let l=o.edit.onOpen(n);this._showCustomPrompt(o.prompt,l).then(s=>{if(s){let a=Array.isArray(s)?s:[s],h=o.onInsert(a),r=this._createProtectedBlock(h,o);n.parentNode.replaceChild(r,n),this._textarea.value=this._cleanHTML(e.querySelector(".yeditor-content").innerHTML),this._dispatchEvent("yeditor-change",{content:this._textarea.value})}}),t.remove()}},_createProtectedBlock:function(e,n){let t=new DOMParser().parseFromString(e,"text/html"),i=t.body.firstElementChild,l=i&&t.body.children.length===1&&t.body.textContent.trim()===i.textContent.trim(),s;return l?s=i:(s=document.createElement(n.inline?"span":"div"),s.innerHTML=e),s.dataset.yeditorBlock="true",s.dataset.yeditorType=n.title||"Block",s.contentEditable="false",s.style.userSelect="all",n.inline?s.style.display="inline-block":s.style.display="block",n.edit&&n.edit.selector.startsWith(".")&&s.classList.add(n.edit.selector.substring(1)),s},_customButtons:[],registerButton:function(e){this._customButtons.push(e)},_addCustomButtons:function(e){this._customButtons.forEach(n=>{let o=document.createElement("button");o.type="button",o.title=n.title,o.innerHTML=n.icon,o.addEventListener("click",()=>{let t=this._shadowRoot.getSelection(),i=t.rangeCount>0?t.getRangeAt(0):null;this._showCustomPrompt(n.prompt,{}).then(l=>{if(!(!l||Array.isArray(l)&&l.length===0)&&i){t.removeAllRanges(),t.addRange(i);let s=Array.isArray(l)?l:[l],a=n.onInsert(s),h=this._createProtectedBlock(a,n),r=DOMPurify.sanitize(h.outerHTML,{ADD_ATTR:["style","contenteditable","data-yeditor-block","data-yeditor-type","data-yeditor-resizable"],ADD_TAGS:["div","span"]});document.execCommand("insertHTML",!1,r+(n.inline?"":"<p><br></p>"))}})}),e.appendChild(o)})},_showCustomPrompt:function(e,n={}){return new Promise(o=>{let t=document.createElement("div"),i=e.multiple===!0;t.innerHTML=`
                <label for="custom-search">${e.label}</label>
                <input type="text" id="custom-search" placeholder="${e.placeholder}" autocomplete="off">
                <div class="search-results"></div>
                ${i?'<div class="selected-items-container"></div>':""}
            `;let l=document.createElement("div"),s=document.createElement("button");s.textContent=this.t("cancel");let a=document.createElement("button");a.textContent=this.t("ok"),a.className="active",l.append(s,a);let h=this._createModal(e.title,t,l),r=t.querySelector("#custom-search");requestAnimationFrame(()=>r.focus());let p=t.querySelector(".search-results"),m=t.querySelector(".selected-items-container"),y=[];i&&Array.isArray(n)?y=[...n]:!i&&n&&typeof n=="object"&&(r.value=n[e.displayField]||"");let f=()=>{m&&(m.innerHTML=y.map((d,v)=>{let u=d.id?`<small style="opacity: 0.7; margin-inline-start: 4px; font-size: 0.8em;">(#${d.id})</small>`:"";return`
                        <span class="selected-item" data-index="${v}">
                            ${d[e.displayField]}
                            ${u}
                            <button type="button" class="selected-item-remove" title="${this.t("remove")||"Remove"}">
                                <svg viewBox="0 0 24 24" width="14" height="14" style="display: block;"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" fill="currentColor"/></svg>
                            </button>
                        </span>
                    `}).join(""))};i&&f(),r.addEventListener("keydown",d=>{d.key==="Enter"&&(d.preventDefault(),a.click())}),m&&m.addEventListener("click",d=>{let v=d.target.closest(".selected-item-remove");if(v){let u=v.closest(".selected-item"),c=parseInt(u.dataset.index,10);y.splice(c,1),f()}}),r.addEventListener("input",async()=>{let d=r.value.trim().toLowerCase();if(d.length<2){p.innerHTML="";return}let v=await e.search(d);p.innerHTML=v.map(u=>e.renderItem(u)).join("")}),p.addEventListener("click",d=>{let v=d.target.closest("[data-item]");if(!v)return;let u=JSON.parse(v.dataset.item);i?(y.some(c=>c.id===u.id)||(y.push(u),f()),r.value="",p.innerHTML="",r.focus()):(y=[u],r.value=u[e.displayField],p.innerHTML="")}),a.onclick=()=>{h.remove(),o(i?y:y[0]||null)},s.onclick=()=>{h.remove(),o(null)}})},_dispatchEvent:function(e,n={}){this._container&&this._container.dispatchEvent(new CustomEvent(e,{bubbles:!0,composed:!0,detail:n}))},_protectBlocks:function(e){this._customButtons.forEach(n=>{if(!n.edit)return;e.querySelectorAll(n.edit.selector).forEach(t=>{t.dataset.yeditorBlock="true",t.dataset.yeditorType=n.title||"Block",t.contentEditable="false",t.style.userSelect="all",n.inline?t.style.display="inline-block":t.style.display="block"})})},_cleanHTML:function(e){let n=document.createElement("div");n.innerHTML=e;let o=["[data-yeditor-block]",'[contenteditable="false"]',".yeditor-image-wrapper"];return n.querySelectorAll(o.join(",")).forEach(t=>{t.removeAttribute("data-yeditor-block"),t.removeAttribute("data-yeditor-type"),t.removeAttribute("contenteditable"),t.style.userSelect==="all"&&(t.style.userSelect=""),(t.style.display==="inline-block"||t.style.display==="block")&&this._customButtons.find(l=>l.edit&&t.matches(l.edit.selector))&&(t.style.display="")}),n.querySelectorAll(".yeditor-image-wrapper").forEach(t=>{let i=t.querySelector("img");i&&t.parentNode.replaceChild(i,t)}),n.innerHTML}};window.yEditor=k;})();
