(()=>{var L={_loadedTranslations:{},_defaultLang:"en",_cssContent:null,_scriptPath:null,_getToolbarButtons:function(){return[{command:"removeFormat",title:"removeFormat",icon:'<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.27 5L2 6.27l6.97 6.97L6.5 19h3l1.57-3.66L16.73 21 18 19.73 4.54 6.27.27 3.27 3.27 5zM6 5v.18L8.82 8h2.4l-.72 1.68 2.1 2.1L14.21 8H20V5H6z"/></svg>'},{command:"bold",title:"bold",icon:'<svg fill="#000000" width="24px" height="24px" viewBox="0 0 1.08 1.08" version="1.1" preserveAspectRatio="xMidYMid meet" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><title>bold-line</title><path d="M0.673 0.526a0.14 0.14 0 0 0 0.084 -0.131v-0.002a0.133 0.133 0 0 0 -0.039 -0.098 0.213 0.213 0 0 0 -0.154 -0.052h-0.21A0.051 0.051 0 0 0 0.3 0.296V0.78a0.052 0.052 0 0 0 0.052 0.052h0.22c0.131 0 0.217 -0.056 0.217 -0.161v-0.002c0 -0.08 -0.048 -0.119 -0.117 -0.143m-0.263 -0.184h0.136c0.06 0 0.095 0.027 0.095 0.07v0.002c0 0.05 -0.041 0.075 -0.101 0.075h-0.129ZM0.671 0.66c0 0.048 -0.039 0.073 -0.104 0.073h-0.157v-0.144h0.15c0.075 0 0.111 0.026 0.111 0.071Z" class="clr-i-outline clr-i-outline-path-1"/><path x="0" y="0" width="36" height="36" fill-opacity="0" d="M0 0H1.08V1.08H0V0z"/></svg>'},{command:"italic",title:"italic",icon:'<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px"><path d="M0 0h24v24H0z" fill="none"/><path d="M10 4v3h2.21l-3.42 8H6v3h8v-3h-2.21l3.42-8H18V4z"/></svg>'},{command:"underline",title:"underline",icon:'<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px"><path d="M0 0h24v24H0z" fill="none"/><path d="M12 17c3.31 0 6-2.69 6-6V3h-2.5v8c0 1.93-1.57 3.5-3.5 3.5S8.5 12.93 8.5 11V3H6v8c0 3.31 2.69 6 6 6zm-7 2v2h14v-2H5z"/></svg>'},{command:"createLink",title:"link",icon:'<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"/></svg>'},{command:"unlink",title:"unlink",icon:'<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M16 13h-2.55v-2H16v2zm-6.45 0H7v-2h2.55v2zM17 7h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1 0 1.43-.98 2.63-2.31 2.96l1.46 1.46C20.88 15.61 22 13.95 22 12c0-2.76-2.24-5-5-5zM7 9h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1S5.29 9 7 9zm5 10c2.76 0 5-2.24 5-5h-1.9c0 1.71-1.39 3.1-3.1 3.1s-3.1-1.39-3.1-3.1H7c0 2.76 2.24 5 5 5z"/><path d="M3.41 4.83L2 6.24l18 18 1.41-1.41z"/></svg>'},{command:"formatBlock",value:"blockquote",title:"quote",icon:'<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0z" fill="none"/><path d="M6 17h3l2-4V7H5v6h3l-2 4zm8 0h3l2-4V7h-6v6h3l-2 4z"/></svg>'},{command:"insertTable",title:"table",icon:'<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M20 2H4c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM8 20H4v-4h4v4zm0-6H4v-4h4v4zm0-6H4V4h4v4zm6 12h-4v-4h4v4zm0-6h-4v-4h4v4zm0-6h-4V4h4v4zm6 12h-4v-4h4v4zm0-6h-4v-4h4v4zm0-6h-4V4h4v4z"/></svg>'},{command:"insertHorizontalRule",title:"horizontalRule",icon:'<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0z" fill="none"/><path d="M4 11h16v2H4z"/></svg>'},{command:"insertImage",title:"insertImage",icon:'<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0z" fill="none"/><path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"/></svg>'},{command:"insertUnorderedList",title:"unorderedList",icon:'<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px"><path d="M0 0h24v24H0z" fill="none"/><path d="M4 10.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm0-6c-.83 0-1.5.67-1.5 1.5S3.17 7.5 4 7.5 5.5 6.83 5.5 6 4.83 4.5 4 4.5zm0 12c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zM7 19h14v-2H7v2zm0-6h14v-2H7v2zm0-8v2h14V5H7z"/></svg>'},{command:"insertOrderedList",title:"orderedList",icon:'<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px"><path d="M0 0h24v24H0z" fill="none"/><path d="M2 17h2v.5H3v1h1v.5H2v1h3v-4H2v1zm1-9h1V4H2v1h1v3zm-1 3h1.8L2 13.1v.9h3v-1H3.2L5 10.9V10H2v1zm5-6v2h14V5H7zm0 14h14v-2H7v2zm0-6h14v-2H7v2z"/></svg>'}]},init:async function(t,o={}){let e={lang:"en",direction:"ltr",theme:"light",quickLinksApiUrl:null,imageGalleryApiUrl:null,fileBrowserOptions:{},fileBrowserUrl:null,...o};if(this.config=e,await this._ensureDOMPurify(),!this._scriptPath){let p=document.querySelector('script[src*="editor.js"]');if(p){let c=p.src;this._scriptPath=c.substring(0,c.lastIndexOf("/"))}else this._scriptPath=".",console.warn("yEditor: Could not determine script path. Assuming assets are relative to the HTML document.")}await this._loadCSS(),await this._loadLanguage(e.lang),this.t=p=>this._loadedTranslations[this.config.lang]?.[p]||this._loadedTranslations[this._defaultLang]?.[p]||p;let n=document.querySelector(t);if(!n){console.error("yEditor: Element not found for selector:",t);return}n.style.display="none";let i=document.createElement("div");i.className="yeditor-container",i.dataset.theme=e.theme;let l=i.attachShadow({mode:"open"});this._shadowRoot=l,this._textarea=n;let s=document.createElement("style");s.textContent=this._cssContent,l.appendChild(s);let r=this.createToolbar(),d=this.createContentArea(n.value,e.direction);l.appendChild(r),l.appendChild(d);let h=document.createElement("div");h.className="yeditor-statusbar",h.innerHTML=`
            <div class="yeditor-dom-path"></div>
            <div class="yeditor-word-count"></div>
        `,l.appendChild(h),n.parentNode.insertBefore(i,n),this.setupEventListeners(l,r,d,n),document.addEventListener("click",p=>{!i.contains(p.target)&&!p.composedPath().includes(i)&&(this.hideLinkToolbar(l),this.hideTableToolbar(l),this._customButtons.forEach(c=>{if(c.edit){let m=l.querySelector(`[data-bubble-for="${c.edit.selector}"]`);m&&m.remove()}}))})},_loadCSS:async function(){if(!this._cssContent)try{let t=`${this._scriptPath}/editor.css`,o=await fetch(t);if(!o.ok)throw new Error("editor.css not found");this._cssContent=await o.text()}catch(t){console.error("yEditor: Failed to load CSS.",t)}},_ensureDOMPurify:function(){return new Promise((t,o)=>{if(window.DOMPurify)return t();console.log("yEditor: DOMPurify not found. Loading from CDN...");let e=document.createElement("script");e.src="https://cdn.jsdelivr.net/npm/dompurify@3.0.11/dist/purify.min.js",e.onload=()=>{console.log("yEditor: DOMPurify loaded successfully."),t()},e.onerror=()=>o(new Error("yEditor: Failed to load DOMPurify from CDN.")),document.head.appendChild(e)})},_loadLanguage:async function(t){if(!this._loadedTranslations[t])try{let o=`${this._scriptPath}/lang/${t}.json`,e=await fetch(o);if(!e.ok)throw new Error(`Language file not found: ${t}.json`);this._loadedTranslations[t]=await e.json()}catch(o){console.error(`yEditor: Failed to load language '${t}'. Falling back to default.`,o),t!==this._defaultLang&&await this._loadLanguage(this._defaultLang)}},createToolbar:function(){let t=document.createElement("div");t.className="yeditor-toolbar";let o={[this.t("paragraph")||"Paragraph"]:"p",[this.t("heading1")||"Heading 1"]:"h1",[this.t("heading2")||"Heading 2"]:"h2",[this.t("heading3")||"Heading 3"]:"h3",[this.t("heading4")||"Heading 4"]:"h4",[this.t("heading5")||"Heading 5"]:"h5",[this.t("heading6")||"Heading 6"]:"h6"},e=document.createElement("div");e.className="yeditor-dropdown";let n=document.createElement("button");n.innerHTML=this.t("headings")||"Headings",n.style.width="auto",n.style.padding="0 10px";let i=document.createElement("div");i.className="yeditor-dropdown-content";for(let[u,a]of Object.entries(o)){let g=document.createElement("button");g.dataset.command="formatBlock",g.dataset.value=a,g.textContent=u,i.appendChild(g)}e.append(n,i),t.appendChild(e),this._getToolbarButtons().forEach(u=>{let a=document.createElement("button");a.type="button",a.dataset.command=u.command,u.value&&(a.dataset.value=u.value),a.title=this.t(u.title),a.innerHTML=u.icon,t.appendChild(a)});let s=["#000000","#6c757d","#dc3545","#fd7e14","#ffc107","#28a745","#17a2b8","#007bff","#6f42c1","#e83e8c","#adb5bd","#ffffff"],r=document.createElement("div");r.className="yeditor-dropdown";let d=document.createElement("button");d.title=this.t("textColor"),d.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0z" fill="none"/><path d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9c.83 0 1.5-.67 1.5-1.5 0-.39-.15-.74-.39-1.01-.23-.26-.38-.61-.38-.99 0-.83.67-1.5 1.5-1.5H16c2.76 0 5-2.24 5-5 0-4.42-4.03-8-9-8zm-5.5 9c-.83 0-1.5-.67-1.5-1.5S5.67 9 6.5 9 8 9.67 8 10.5 7.33 12 6.5 12zm3-4C8.67 8 8 7.33 8 6.5S8.67 5 9.5 5s1.5.67 1.5 1.5S10.33 8 9.5 8zm5 0c-.83 0-1.5-.67-1.5-1.5S13.67 5 14.5 5s1.5.67 1.5 1.5S15.33 8 14.5 8zm3 4c-.83 0-1.5-.67-1.5-1.5S16.67 9 17.5 9s1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"/></svg>';let h=document.createElement("div");h.className="yeditor-dropdown-content yeditor-color-grid",s.forEach(u=>{let a=document.createElement("button");a.className="yeditor-color-swatch",a.dataset.command="foreColor",a.dataset.value=u,a.style.backgroundColor=u,a.title=u,h.appendChild(a)}),r.append(d,h),t.appendChild(r);let p={justifyLeft:{title:"alignLeft",icon:'<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px"><path d="M0 0h24v24H0z" fill="none"/><path d="M15 15H3v2h12v-2zm0-8H3v2h12V7zM3 13h18v-2H3v2zm0 8h18v-2H3v2zM3 3v2h18V3H3z"/></svg>'},justifyCenter:{title:"alignCenter",icon:'<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px"><path d="M0 0h24v24H0z" fill="none"/><path d="M7 15v2h10v-2H7zm-4 6h18v-2H3v2zm0-8h18v-2H3v2zm4-6v2h10V7H7zM3 3v2h18V3H3z"/></svg>'},justifyRight:{title:"alignRight",icon:'<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 21h18v-2H3v2zm6-4h12v-2H9v2zm-6-4h18v-2H3v2zm6-4h12V7H9v2zM3 3v2h18V3H3z"/></svg>'}},c=document.createElement("div");c.className="yeditor-dropdown",c.dataset.group="align";let m=document.createElement("button"),v=this.config.direction==="rtl"?"justifyRight":"justifyLeft";m.innerHTML=p[v].icon,m.title=this.t(p[v].title);let f=document.createElement("div");return f.className="yeditor-dropdown-content",Object.entries(p).forEach(([u,a])=>{let g=document.createElement("button");g.dataset.command=u,g.title=this.t(a.title),g.innerHTML=a.icon,f.appendChild(g)}),c.append(m,f),t.appendChild(c),this._addCustomButtons(t),[{command:"setDirection",value:"ltr",title:"setDirectionLtr",icon:'<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px"><path d="M0 0h24v24H0z" fill="none"/><path d="M9 10v5h2V4h2v11h2V4h2V2H9C6.79 2 5 3.79 5 6s1.79 4 4 4zm12 8l-4-4v3H5v2h12v3l4-4z"/></svg>'},{command:"setDirection",value:"rtl",title:"setDirectionRtl",icon:'<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px"><path d="M0 0h24v24H0z" fill="none"/><path d="M10 10v5h2V4h2v11h2V4h2V2h-8C7.79 2 6 3.79 6 6s1.79 4 4 4zm-2 7v-3l-4 4 4 4v-3h12v-2H8z"/></svg>'}].forEach(u=>{let a=document.createElement("button");a.type="button",a.dataset.command=u.command,a.dataset.value=u.value,a.title=this.t(u.title),a.innerHTML=u.icon,t.appendChild(a)}),t},createContentArea:function(t,o){let e=document.createElement("div");return e.className="yeditor-content",e.contentEditable=!0,e.dir=o,e.innerHTML=DOMPurify.sanitize(t),e},setupEventListeners:function(t,o,e,n){t.addEventListener("click",i=>{i.target.closest(".yeditor-dropdown > button")||t.querySelectorAll(".yeditor-dropdown.active").forEach(l=>l.classList.remove("active"))}),o.addEventListener("click",i=>{let l=i.target.closest(".yeditor-dropdown");l&&(l.classList.toggle("active"),t.querySelectorAll(".yeditor-dropdown").forEach(m=>{m!==l&&m.classList.remove("active")}));let s=i.target.closest("button[data-command]");if(!s)return;let{command:r,value:d}=s.dataset,h=s.closest(".yeditor-dropdown");h&&h.classList.remove("active");let p=t.getSelection?t.getSelection():window.getSelection(),c=p.rangeCount>0?p.getRangeAt(0):null;if(r==="createLink"){let m=c?c.startContainer.parentElement.closest("a"):null;if(m){let v={url:m.href,newWindow:m.target==="_blank"};this.showLinkPrompt(t,v).then(f=>{f&&(m.href=f.url,f.newWindow?m.target="_blank":m.removeAttribute("target"))})}else{if(!c||c.collapsed){this.showAlert(t,this.t("linkTextRequired"));return}this.showLinkPrompt(t).then(v=>{if(v&&c){p.removeAllRanges(),p.addRange(c),document.execCommand("createLink",!1,v.url);let f=p.anchorNode.parentElement.closest("a");f&&v.newWindow&&f.setAttribute("target","_blank")}})}}else if(r==="insertTable"){this.showTablePrompt(t).then(m=>{if(m&&c){p.removeAllRanges(),p.addRange(c);let v=this._createTableHTML(m.rows,m.cols);document.execCommand("insertHTML",!1,v)}});return}else if(r==="insertImage"){this.showImagePrompt(t).then(m=>{if(m&&m.url&&c){p.removeAllRanges(),p.addRange(c);let v=DOMPurify.sanitize(m.alt,{USE_PROFILES:{html:!1}});document.execCommand("insertHTML",!1,`<img src="${m.url}" alt="${v}">`)}});return}else r==="formatBlock"&&d==="blockquote"?(c?c.startContainer.parentElement.closest("blockquote"):null)?document.execCommand("formatBlock",!1,"p"):document.execCommand("formatBlock",!1,"blockquote"):r==="setDirection"?this.setBlockDirection(t,d):document.execCommand(r,!1,d||null);e.focus()}),e.addEventListener("input",()=>{n.value=DOMPurify.sanitize(e.innerHTML),this.updateDomPath(t,e),this.updateWordCount(t,e)}),t.addEventListener("selectionchange",()=>{this.updateDomPath(t,e)}),e.addEventListener("click",i=>{this.updateDomPath(t,e);let l=i.target.closest("a"),s=i.target.closest("table"),r=i.target.closest("img");l?(this.showLinkToolbar(t,l),i.preventDefault()):this.hideLinkToolbar(t),s?this.showTableToolbar(t,s):this.hideTableToolbar(t),r?this._handleImageSelection(t,r):this._clearImageSelection(t)}),this.updateWordCount(t,e),this.updateDomPath(t,e),e.addEventListener("keyup",i=>{(i.key===" "||i.code==="Space")&&this._handleMarkdown(t)}),e.addEventListener("keydown",i=>{i.key==="Tab"&&this._handleTabInTable(i)})},showAlert:function(t,o){let e=document.createElement("p");e.textContent=o;let n=document.createElement("div"),i=document.createElement("button");i.textContent=this.t("ok"),i.className="active",n.appendChild(i);let l=this._createModal(this.t("alertTitle"),e,n);requestAnimationFrame(()=>i.focus()),i.onclick=()=>l.remove()},showTablePrompt:function(t,o={}){return new Promise(e=>{let n=document.createElement("div");n.innerHTML=`
                <div class="input-group">
                    <div>
                        <label for="table-rows">${this.t("rows")}</label>
                        <input type="number" id="table-rows" min="1">
                    </div>
                    <div>
                        <label for="table-cols">${this.t("columns")}</label>
                        <input type="number" id="table-cols" min="1">
                    </div>
                </div>
                <div class="checkbox-container">
                    <input type="checkbox" id="table-header">
                    <label for="table-header">${this.t("headerRow")}</label>
                </div>
            `;let i=document.createElement("div"),l=document.createElement("button");l.textContent=this.t("cancel");let s=document.createElement("button");s.textContent=this.t("ok"),s.className="active",i.append(l,s);let r=this._createModal(this.t("table"),n,i),d=n.querySelector("#table-rows"),h=n.querySelector("#table-cols"),p=n.querySelector("#table-header");d.value=o.rows||2,h.value=o.cols||2,p.checked=o.header||!1,requestAnimationFrame(()=>d.focus()),[d,h].forEach(c=>{c.addEventListener("keydown",m=>{m.key==="Enter"&&(m.preventDefault(),s.click())})}),s.onclick=()=>{r.remove(),e({rows:parseInt(d.value,10),cols:parseInt(h.value,10),header:p.checked})},l.onclick=()=>{r.remove(),e(null)}})},showImagePrompt:function(t,o={}){return new Promise(e=>{let n=document.createElement("div");n.innerHTML=`
                <div class="yeditor-modal-tabs">
                    <button class="active" data-tab="url">${this.t("fromUrl")}</button>
                    <button data-tab="gallery">${this.t("fromGallery")}</button>
                </div>
                <div id="tab-url" class="yeditor-modal-tab-content active">
                    <label for="image-url">${this.t("linkUrlLabel")}</label>
                    <div class="input-with-button">
                        <input type="text" id="image-url" placeholder="https://..." value="${o.url||""}">
                        <button type="button" id="yeditor-browse-server" class="yeditor-browse-button">${this.t("browseServer")}</button>
                    </div>
                </div>
                <div id="tab-gallery" class="yeditor-modal-tab-content">
                    <div class="image-gallery"></div>
                </div>
                <div style="margin-top: 15px;">
                    <label for="image-alt">${this.t("altText")}</label>
                    <input type="text" id="image-alt" value="${o.alt||""}">
                </div>
            `;let i=document.createElement("div"),l=document.createElement("button");l.textContent=this.t("cancel");let s=document.createElement("button");s.textContent=this.t("ok"),s.className="active",i.append(l,s);let r=this._createModal(this.t("insertImage"),n,i);requestAnimationFrame(()=>n.querySelector("#image-url").focus());let d=n.querySelector("#image-url"),h=n.querySelector("#image-alt"),p=n.querySelector("#yeditor-browse-server");this.config.fileBrowserUrl?p.addEventListener("click",()=>{window.yEditorFileBrowserCallback=b=>{b&&(d.value=b),delete window.yEditorFileBrowserCallback};let u=this.config.fileBrowserOptions||{},a=u.width||900,g=u.height||600,y=u.left!==void 0?u.left:(window.screen.width-a)/2,x=u.top!==void 0?u.top:(window.screen.height-g)/2;window.open(this.config.fileBrowserUrl,"yEditorFileBrowser",`width=${a},height=${g},left=${y},top=${x},resizable=yes,scrollbars=yes`)}):p.style.display="none",[d,h].forEach(u=>{u.addEventListener("keydown",a=>{a.key==="Enter"&&(a.preventDefault(),s.click())})});let c=n.querySelectorAll(".yeditor-modal-tabs button"),m=n.querySelectorAll(".yeditor-modal-tab-content");c.forEach(u=>{u.addEventListener("click",()=>{c.forEach(a=>a.classList.remove("active")),u.classList.add("active"),m.forEach(a=>a.classList.remove("active")),n.querySelector(`#tab-${u.dataset.tab}`).classList.add("active")})});let v=n.querySelector(".image-gallery"),f=n.querySelector('button[data-tab="gallery"]');this.config.imageGalleryApiUrl?fetch(this.config.imageGalleryApiUrl).then(u=>u.json()).then(u=>{v.innerHTML=u.map(a=>`
                            <div class="image-gallery-item" data-url="${a.url}" data-title="${a.title}">
                                <img src="${a.url}" alt="${a.title}">
                            </div>
                        `).join("")}):f.style.display="none";let w="";v.addEventListener("click",u=>{let a=u.target.closest(".image-gallery-item");a&&(v.querySelectorAll(".image-gallery-item").forEach(g=>g.classList.remove("selected")),a.classList.add("selected"),w=a.dataset.url,n.querySelector("#image-alt").value=a.dataset.title)}),s.onclick=()=>{let a=n.querySelector(".yeditor-modal-tabs button.active").dataset.tab==="gallery"?w:n.querySelector("#image-url").value,g=n.querySelector("#image-alt").value;r.remove(),e({url:a,alt:g})},l.onclick=()=>{r.remove(),e(null)}})},showLinkPrompt:function(t,o={}){return new Promise(e=>{let n=this.config.quickLinksApiUrl?this.t("linkPlaceholder"):this.t("linkPlaceholderSimple"),i=document.createElement("div");i.innerHTML=`
                <label for="link-url">${this.t("linkUrlLabel")}</label>
                <input type="text" id="link-url" placeholder="${n}" autocomplete="off">
                <div class="search-results"></div>
                <div class="checkbox-container">
                    <input type="checkbox" id="link-new-window">
                    <label for="link-new-window">${this.t("linkNewWindowLabel")}</label>
                </div>
            `;let l=document.createElement("div"),s=document.createElement("button");s.textContent=this.t("cancel");let r=document.createElement("button");r.textContent=this.t("ok"),r.className="active",l.append(s,r);let d=this._createModal(this.t("linkPromptTitle"),i,l),h=i.querySelector("#link-url"),p=i.querySelector("#link-new-window"),c=i.querySelector(".search-results");h.value=o.url||"",p.checked=o.newWindow||!1,requestAnimationFrame(()=>{h.focus(),h.select()});let m=v=>{d.remove(),e(v)};if(r.onclick=()=>m({url:h.value,newWindow:p.checked}),s.onclick=()=>m(null),h.addEventListener("keydown",v=>{if(v.key==="Enter"){v.preventDefault();let w=c.querySelector(".selected");w?w.click():r.click();return}let f=c.querySelectorAll(".search-result-item");if(f.length>0&&(v.key==="ArrowDown"||v.key==="ArrowUp")){v.preventDefault();let w=c.querySelector(".selected"),u=-1;w&&(u=Array.from(f).indexOf(w),w.classList.remove("selected"));let a;v.key==="ArrowDown"?a=(u+1)%f.length:a=(u-1+f.length)%f.length;let g=f[a];g&&(g.classList.add("selected"),g.scrollIntoView({block:"nearest"}))}}),this.config.quickLinksApiUrl){let v;h.addEventListener("input",()=>{clearTimeout(v),v=setTimeout(async()=>{let f=h.value.trim().toLowerCase();if(f.length<2){c.innerHTML="";return}try{let a=(await(await fetch(this.config.quickLinksApiUrl)).json()).filter(g=>g.title.toLowerCase().includes(f)||g.url.toLowerCase().includes(f));c.innerHTML=a.map(g=>`<a class="search-result-item" data-url="${g.url}">
                                    ${g.title}
                                    <small>${g.url}</small>
                                </a>`).join("")}catch(w){console.error("Quick links API error:",w)}},300)})}c.addEventListener("click",v=>{let f=v.target.closest(".search-result-item");f&&(h.value=f.dataset.url,c.innerHTML="",h.focus())})})},_createModal:function(t,o,e){let n=document.createElement("div");n.className="yeditor-modal-overlay";let i=document.createElement("div");i.className="yeditor-modal";let l=document.createElement("div");l.className="yeditor-modal-header",l.textContent=t;let s=document.createElement("div");s.className="yeditor-modal-body",s.appendChild(o);let r=document.createElement("div");return r.className="yeditor-modal-footer",r.appendChild(e),i.append(l,s,r),n.appendChild(i),this._injectModalStyles(),document.body.appendChild(n),requestAnimationFrame(()=>n.classList.add("active")),n},_createTableHTML:function(t,o,e){let n="<table>";if(e){n+="<thead><tr>";for(let i=0;i<o;i++)n+="<th>&nbsp;</th>";n+="</tr></thead>",t--}if(n+="<tbody>",t>0)for(let i=0;i<t;i++){n+="<tr>";for(let l=0;l<o;l++)n+="<td>&nbsp;</td>";n+="</tr>"}return n+="</tbody></table><p><br></p>",n},_injectModalStyles:function(){if(document.getElementById("yeditor-modal-styles"))return;let t=document.createElement("style");t.id="yeditor-modal-styles";let o=this._cssContent.substring(this._cssContent.indexOf("/* --- Modal (Popup) Styles --- */"));t.textContent=o.replace(/:host\(\[data-theme="dark"\]\)/g,'body[data-yeditor-theme="dark"]'),document.head.appendChild(t)},showLinkToolbar:function(t,o){this.hideLinkToolbar(t);let e=document.createElement("div");e.className="link-toolbar";let n=document.createElement("a");n.href=o.href,n.textContent=o.href,n.target="_blank",n.rel="noopener noreferrer";let i=document.createElement("button");i.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>',i.title=this.t("linkPromptTitle");let l=document.createElement("button");l.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M16 13h-2.55v-2H16v2zm-6.45 0H7v-2h2.55v2zM17 7h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1 0 1.43-.98 2.63-2.31 2.96l1.46 1.46C20.88 15.61 22 13.95 22 12c0-2.76-2.24-5-5-5zM7 9h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1S5.29 9 7 9zm5 10c2.76 0 5-2.24 5-5h-1.9c0 1.71-1.39 3.1-3.1 3.1s-3.1-1.39-3.1-3.1H7c0 2.76 2.24 5 5 5z"/><path d="M3.41 4.83L2 6.24l18 18 1.41-1.41z"/></svg>',l.title=this.t("unlink"),e.append(n,i,l),t.appendChild(e),requestAnimationFrame(()=>{let s=o.getBoundingClientRect(),r=t.host.getBoundingClientRect(),d=s.top-r.top-e.offsetHeight-5,h=s.left-r.left+s.width/2;e.style.top=`${d}px`,e.style.left=`${h}px`,e.classList.add("active")}),i.onclick=()=>{let s={url:o.href,newWindow:o.target==="_blank"};this.showLinkPrompt(t,s).then(r=>{r&&(o.href=r.url,r.newWindow?o.target="_blank":o.removeAttribute("target"))}),this.hideLinkToolbar(t)},l.onclick=()=>{let s=t.getSelection?t.getSelection():window.getSelection(),r=document.createRange();r.selectNode(o),s.removeAllRanges(),s.addRange(r),document.execCommand("unlink",!1,null),this.hideLinkToolbar(t)}},hideLinkToolbar:function(t){let o=t.querySelector(".link-toolbar");o&&o.remove()},showTableToolbar:function(t,o){this.hideTableToolbar(t);let e=document.createElement("div");e.className="table-toolbar";let n=document.createElement("button");n.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M22 13h-8v-2h8v2zm0-6h-8v2h8V7zm-8 10h8v-2h-8v2zM12 7v10H4V7h8zm-2 8H6v-2h4v2zm0-4H6v-2h4v2z"/></svg>',n.title=this.t("addRow");let i=document.createElement("button");i.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>',i.title=this.t("editTable"),e.append(i,n),t.appendChild(e),requestAnimationFrame(()=>{let l=o.getBoundingClientRect(),s=t.host.getBoundingClientRect(),r=l.top-s.top-e.offsetHeight-5,d=l.left-s.left+l.width/2;e.style.top=`${r}px`,e.style.left=`${d}px`,e.classList.add("active")}),n.onclick=()=>{let l=o.querySelector("tbody");if(!l)return;let s=l.insertRow(-1),r=o.rows[0]?.cells.length||1;for(let d=0;d<r;d++)s.insertCell(d).innerHTML="&nbsp;"},i.onclick=()=>{let l={rows:o.rows.length,cols:o.rows[0]?.cells.length||0,header:!!o.querySelector("thead")};this.showTablePrompt(t,l).then(s=>{if(s){let r=this._createTableHTML(s.rows,s.cols,s.header),d=document.createElement("div");d.innerHTML=r;let h=DOMPurify.sanitize(d.innerHTML,{ADD_TAGS:["table","thead","tbody","tr","th","td"],ADD_ATTR:["style","border"]});o.parentNode.replaceChild(h,o)}}),this.hideTableToolbar(t)}},hideTableToolbar:function(t){let o=t.querySelector(".table-toolbar");o&&o.remove()},_handleImageSelection:function(t,o){this._clearImageSelection(t);let e=o.parentElement;e.classList.contains("yeditor-image-wrapper")||(e=document.createElement("span"),e.className="yeditor-image-wrapper",o.parentNode.insertBefore(e,o),e.appendChild(o)),e.classList.add("resizable"),e.style.width=`${o.offsetWidth}px`,e.style.height=`${o.offsetHeight}px`,this.showImageToolbar(t,e,o);let n=()=>{o.style.width=e.style.width,o.style.height=e.style.height,e.classList.remove("resizable"),this._textarea.value=DOMPurify.sanitize(e.closest(".yeditor-content").innerHTML),e.classList.add("resizable"),document.removeEventListener("mouseup",n)};document.addEventListener("mouseup",n)},_clearImageSelection:function(t){t.querySelectorAll(".yeditor-image-wrapper.resizable").forEach(o=>{o.classList.remove("resizable")}),this.hideImageToolbar(t)},showImageToolbar:function(t,o,e){this.hideImageToolbar(t);let n=document.createElement("div");n.className="image-toolbar";let i=document.createElement("button");i.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>',i.title=this.t("editImage");let l=document.createElement("button");l.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0z" fill="none"/><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/></svg>',l.title=this.t("deleteImage"),n.append(i,l),t.appendChild(n),requestAnimationFrame(()=>{let s=o.getBoundingClientRect(),r=t.host.getBoundingClientRect();n.style.top=`${s.top-r.top-n.offsetHeight-5}px`,n.style.left=`${s.left-r.left+s.width/2}px`,n.classList.add("active")}),i.onclick=()=>{this.showImagePrompt(t,{url:e.src,alt:e.alt}).then(s=>{s&&(e.src=s.url,e.alt=s.alt)})},l.onclick=()=>{o.remove(),this.hideImageToolbar(t),t.querySelector(".yeditor-content").dispatchEvent(new Event("input",{bubbles:!0,cancelable:!0}))}},hideImageToolbar:function(t){let o=t.querySelector(".image-toolbar");o&&o.remove()},_handleTabInTable:function(t){let o=this._shadowRoot.getSelection();if(!o||!o.rangeCount)return;let e=o.anchorNode.parentElement.closest("td, th");if(!e)return;t.preventDefault();let n=e.closest("table"),i=Array.from(n.querySelectorAll("td, th")),l=i.indexOf(e),s;if(t.shiftKey){if(s=l-1,s<0)return}else if(s=l+1,s>=i.length){let h=(n.querySelector("tbody")||n).insertRow(-1),p=e.parentElement.cells.length;for(let c=0;c<p;c++)h.insertCell(c).innerHTML="&nbsp;";this._focusCell(h.cells[0]);return}let r=i[s];r&&this._focusCell(r)},_focusCell:function(t){let o=document.createRange(),e=this._shadowRoot.getSelection();o.selectNodeContents(t),e.removeAllRanges(),e.addRange(o)},_handleMarkdown:function(t){let o=t.getSelection();if(!o||!o.rangeCount)return;let e=o.getRangeAt(0),n=e.startContainer;if(n.nodeType!==Node.TEXT_NODE||e.startOffset<2)return;let i=n.parentElement;if(i.tagName!=="P"&&!i.tagName.startsWith("H"))return;let s=n.textContent.substring(0,e.startOffset).match(/^(#{1,6})\s$/);if(s){let d=`h${s[1].length}`,h=document.createRange();h.setStart(n,0),h.setEnd(n,s[0].length),o.removeAllRanges(),o.addRange(h),document.execCommand("insertText",!1,""),document.execCommand("formatBlock",!1,d)}},updateWordCount:function(t,o){let e=t.querySelector(".yeditor-word-count");if(!e)return;let l=(o.innerText||"").trim().split(/\s+/).filter(Boolean).length;e.textContent=`${this.t("words")||"Words"}: ${l}`},updateDomPath:function(t,o){let e=t.querySelector(".yeditor-dom-path");if(!e)return;let n=t.getSelection?t.getSelection():window.getSelection();if(!n||n.rangeCount===0)return;let i=n.anchorNode,l=[];for(;i&&i!==o;)i.nodeType===Node.ELEMENT_NODE&&l.unshift(`<span>${i.tagName.toLowerCase()}</span>`),i=i.parentNode;e.innerHTML=l.join("")},setBlockDirection:function(t,o){let e=t.getSelection?t.getSelection():window.getSelection();if(!e.rangeCount)return;let i=e.getRangeAt(0).startContainer;for(;i&&(!i.style||window.getComputedStyle(i).display!=="block");)i=i.parentNode;i&&i.style&&(i.setAttribute("dir",o),i.style.textAlign=o==="rtl"?"right":"left")},_showCustomBubble:function(t,o,e){t.querySelectorAll("[data-bubble-for]").forEach(l=>l.remove());let n=document.createElement("div");n.className="link-toolbar",n.dataset.bubbleFor=e.edit.selector;let i=document.createElement("button");i.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>',i.title=e.prompt.title,n.appendChild(i),t.appendChild(n),requestAnimationFrame(()=>{let l=o.getBoundingClientRect(),s=t.host.getBoundingClientRect();n.style.top=`${l.top-s.top-n.offsetHeight-5}px`,n.style.left=`${l.left-s.left+l.width/2}px`,n.classList.add("active")}),i.onclick=()=>{let l=e.edit.onOpen(o);this._showCustomPrompt(e.prompt,l).then(s=>{if(s){let r=e.onInsert(s),d=document.createElement("div");d.innerHTML=r;let h=d.firstElementChild;o.parentNode.replaceChild(h,o)}}),n.remove()}},_customButtons:[],registerButton:function(t){this._customButtons.push(t)},_addCustomButtons:function(t){this._customButtons.forEach(o=>{let e=document.createElement("button");e.type="button",e.title=o.title,e.innerHTML=o.icon,e.addEventListener("click",()=>{let n=this._shadowRoot.getSelection(),i=n.rangeCount>0?n.getRangeAt(0):null;this._showCustomPrompt(o.prompt,{}).then(l=>{if(l&&i){n.removeAllRanges(),n.addRange(i);let s=o.onInsert(l),r=DOMPurify.sanitize(s,{ADD_ATTR:["style"]});document.execCommand("insertHTML",!1,r)}})}),t.appendChild(e)})},_showCustomPrompt:function(t,o={}){return new Promise(e=>{let n=document.createElement("div");n.innerHTML=`
                <label for="custom-search">${t.label}</label>
                <input type="text" id="custom-search" placeholder="${t.placeholder}" autocomplete="off">
                <div class="search-results"></div>
            `;let i=document.createElement("div"),l=document.createElement("button");l.textContent=this.t("cancel");let s=document.createElement("button");s.textContent=this.t("ok"),s.className="active",i.append(l,s);let r=this._createModal(t.title,n,i),d=n.querySelector("#custom-search");requestAnimationFrame(()=>d.focus());let h=n.querySelector(".search-results"),p=null;d.value=o[t.displayField]||"",d.addEventListener("keydown",c=>{c.key==="Enter"&&(c.preventDefault(),s.click())}),d.addEventListener("input",async()=>{let c=d.value.trim().toLowerCase();if(c.length<2){h.innerHTML="";return}let m=await t.search(c);h.innerHTML=m.map(v=>t.renderItem(v)).join("")}),h.addEventListener("click",c=>{let m=c.target.closest("[data-item]");m&&(p=JSON.parse(m.dataset.item),d.value=p[t.displayField],h.innerHTML="")}),s.onclick=()=>{r.remove(),e(p)},l.onclick=()=>{r.remove(),e(null)}})}};window.yEditor=L;})();
