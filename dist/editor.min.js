(()=>{var k={_loadedTranslations:{},_defaultLang:"en",_cssContent:null,_scriptPath:null,_instances:{},_getToolbarButtons:function(){return[{command:"removeFormat",title:"removeFormat",icon:'<svg viewBox="0 0 24 24"><path d="M3.27 5L2 6.27l6.97 6.97L6.5 19h3l1.57-3.66L16.73 21l1.8-1.27L4.54 6.27.27 3.27zM6 5v.18L8.82 8h2.4l-.72 1.68 2.1 2.1L14.21 8H20V5z"/></svg>'},{command:"bold",title:"bold",icon:'<svg viewBox="0 0 16 16"><path d="M8.21 13c2.106 0 3.412-1.087 3.412-2.823 0-1.306-.984-2.283-2.324-2.386v-.055a2.176 2.176 0 0 0 1.852-2.14c0-1.51-1.162-2.46-3.014-2.46H3.843V13H8.21zM5.908 4.674h1.696c.963 0 1.517.451 1.517 1.244 0 .834-.629 1.32-1.73 1.32H5.908zm0 6.788V8.598h1.734c1.239 0 1.82.56 1.82 1.414 0 .933-.645 1.53-1.844 1.53H5.908z"/></svg>'},{command:"italic",title:"italic",icon:'<svg viewBox="0 0 24 24"><path d="M10 4v3h2.21l-3.42 8H6v3h8v-3h-2.21l3.42-8H18V4z"/></svg>'},{command:"underline",title:"underline",icon:'<svg viewBox="0 0 24 24"><path d="M12 17c3.31 0 6-2.69 6-6V3h-2.5v8c0 1.93-1.57 3.5-3.5 3.5S8.5 12.93 8.5 11V3H6v8c0 3.31 2.69 6 6 6zm-7 2v2h14v-2z"/></svg>'},{command:"createLink",title:"link",icon:'<svg viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"/></svg>'},{command:"unlink",title:"unlink",icon:'<svg viewBox="0 0 24 24"><path d="M17 7h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1 0 1.43-.98 2.63-2.31 2.96l1.46 1.46C20.88 15.61 22 13.95 22 12c0-2.76-2.24-5-5-5zM7 9h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1S5.29 9 7 9zm-1 4h10v-2H6zm-3.24-8.76L2 6.24l19.76 19.76 1.41-1.41z"/></svg>'},{command:"formatBlock",value:"blockquote",title:"quote",icon:'<svg viewBox="0 0 24 24"><path d="M6 17h3l2-4V7H5v6h3zm8 0h3l2-4V7h-6v6h3z"/></svg>'},{command:"insertTable",title:"table",icon:'<svg viewBox="0 0 24 24"><path d="M20 2H4c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM8 20H4v-4h4zm0-6H4v-4h4zm0-6H4V4h4zm6 12h-4v-4h4zm0-6h-4v-4h4zm0-6h-4V4h4zm6 12h-4v-4h4zm0-6h-4v-4h4zm0-6h-4V4h4z"/></svg>'},{command:"insertHorizontalRule",title:"horizontalRule",icon:'<svg viewBox="0 0 24 24"><path d="M4 11h16v2H4z"/></svg>'},{command:"insertImage",title:"insertImage",icon:'<svg viewBox="0 0 24 24"><path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5z"/></svg>'},{command:"insertUnorderedList",title:"unorderedList",icon:'<svg viewBox="0 0 24 24"><path d="M4 10.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm0-6c-.83 0-1.5.67-1.5 1.5S3.17 7.5 4 7.5 5.5 6.83 5.5 6 4.83 4.5 4 4.5zm0 12c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zM7 19h14v-2H7zm0-6h14v-2H7zm0-8v2h14V5z"/></svg>'},{command:"insertOrderedList",title:"orderedList",icon:'<svg viewBox="0 0 24 24"><path d="M2 17h2v.5H3v1h1v.5H2v1h3v-4H2zm1-9h1V4H2v1h1zm-1 3h1.8L2 13.1v.9h3v-1H3.2L5 10.9V10H2zm5-6v2h14V5zm0 14h14v-2H7zm0-6h14v-2H7z"/></svg>'}]},init:async function(e,o={}){let t={lang:"en",direction:"ltr",theme:"light",quickLinksApiUrl:null,imageGalleryApiUrl:null,fileBrowserOptions:{},fileBrowserUrl:null,...o};if(this.config=t,await this._ensureDOMPurify(),!this._scriptPath){let f=document.querySelector('script[src*="editor.js"], script[src*="editor.min.js"]');if(f){let m=f.src;this._scriptPath=m.substring(0,m.lastIndexOf("/"))}else this._scriptPath=".",console.warn("yEditor: Could not determine script path. Assuming assets are relative to the HTML document.")}await this._loadCSS(),await this._loadLanguage(t.lang),this.t=f=>this._loadedTranslations[this.config.lang]?.[f]||this._loadedTranslations[this._defaultLang]?.[f]||f;let n=document.querySelector(e);if(!n){console.error("yEditor: Element not found for selector:",e);return}n.style.display="none";let s=document.createElement("div");s.className="yeditor-container",s.dataset.theme=t.theme;let i=s.attachShadow({mode:"open"});this._container=s,this._shadowRoot=i,this._textarea=n,this._instances[e]={container:s,shadowRoot:i,textarea:n};let a=document.createElement("style");a.textContent=this._cssContent,i.appendChild(a);let l=this.createToolbar(),u=this.createContentArea(n.value,t.direction);i.appendChild(l),i.appendChild(u);let d=document.createElement("div");d.className="yeditor-statusbar",d.innerHTML=`
            <div class="yeditor-dom-path"></div>
            <div class="yeditor-word-count"></div>
        `,i.appendChild(d),n.parentNode.insertBefore(s,n),this.setupEventListeners(i,l,u,n,s),document.addEventListener("click",f=>{!s.contains(f.target)&&!f.composedPath().includes(s)&&(this.hideLinkToolbar(i),this.hideTableToolbar(i),this._customButtons.forEach(m=>{if(m.edit){let p=i.querySelector(`[data-bubble-for="${m.edit.selector}"]`);p&&p.remove()}}))}),this._dispatchEvent("yeditor-init",{editor:s})},setContent:function(e,o){let t=this._instances[e];if(!t){console.error(`yEditor: No editor instance found for selector "${e}". Was it initialized?`);return}let{shadowRoot:n,textarea:s}=t,i=n.querySelector(".yeditor-content");if(!i)return;let a=DOMPurify.sanitize(o);i.innerHTML=a,i.dispatchEvent(new Event("input",{bubbles:!0,cancelable:!0}))},_loadCSS:async function(){if(this._cssContent)return;let e=`${this._scriptPath}/editor.min.css`,o;try{if(o=await fetch(e),o.ok||(e=`${this._scriptPath}/editor.css`,o=await fetch(e)),!o.ok)throw new Error(`Neither editor.min.css nor editor.css were found at ${this._scriptPath}`);this._cssContent=await o.text()}catch(t){console.error("yEditor: Failed to load CSS.",t)}},_ensureDOMPurify:function(){return new Promise((e,o)=>{if(window.DOMPurify)return e();console.log("yEditor: DOMPurify not found. Loading from CDN...");let t=document.createElement("script");t.src="https://cdn.jsdelivr.net/npm/dompurify@3.0.11/dist/purify.min.js",t.onload=()=>{console.log("yEditor: DOMPurify loaded successfully."),e()},t.onerror=()=>o(new Error("yEditor: Failed to load DOMPurify from CDN.")),document.head.appendChild(t)})},_loadLanguage:async function(e){if(!this._loadedTranslations[e])try{let o=`${this._scriptPath}/lang/${e}.json`,t=await fetch(o);if(!t.ok)throw new Error(`Language file not found: ${e}.json`);this._loadedTranslations[e]=await t.json()}catch(o){console.error(`yEditor: Failed to load language '${e}'. Falling back to default.`,o),e!==this._defaultLang&&await this._loadLanguage(this._defaultLang)}},createToolbar:function(){let e=document.createElement("div");e.className="yeditor-toolbar";let o={[this.t("paragraph")||"Paragraph"]:"p",[this.t("heading1")||"Heading 1"]:"h1",[this.t("heading2")||"Heading 2"]:"h2",[this.t("heading3")||"Heading 3"]:"h3",[this.t("heading4")||"Heading 4"]:"h4",[this.t("heading5")||"Heading 5"]:"h5",[this.t("heading6")||"Heading 6"]:"h6"},t=document.createElement("div");t.className="yeditor-dropdown";let n=document.createElement("button");n.innerHTML=this.t("headings")||"Headings",n.style.width="auto",n.style.padding="0 10px";let s=document.createElement("div");s.className="yeditor-dropdown-content";for(let[c,r]of Object.entries(o)){let b=document.createElement("button");b.dataset.command="formatBlock",b.dataset.value=r,b.textContent=c,s.appendChild(b)}t.append(n,s),e.appendChild(t),this._getToolbarButtons().forEach(c=>{let r=document.createElement("button");r.type="button",r.dataset.command=c.command,c.value&&(r.dataset.value=c.value),r.title=this.t(c.title),r.innerHTML=c.icon,e.appendChild(r)});let a=["#000000","#6c757d","#dc3545","#fd7e14","#ffc107","#28a745","#17a2b8","#007bff","#6f42c1","#e83e8c","#adb5bd","#ffffff"],l=document.createElement("div");l.className="yeditor-dropdown";let u=document.createElement("button");u.title=this.t("textColor"),u.innerHTML='<svg viewBox="0 0 24 24"><path d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9c.83 0 1.5-.67 1.5-1.5 0-.39-.15-.74-.39-1.01-.23-.26-.38-.61-.38-.99 0-.83.67-1.5 1.5-1.5H16c2.76 0 5-2.24 5-5 0-4.42-4.03-8-9-8zM6.5 12c-.83 0-1.5-.67-1.5-1.5S5.67 9 6.5 9 8 9.67 8 10.5 7.33 12 6.5 12zm3-4C8.67 8 8 7.33 8 6.5S8.67 5 9.5 5s1.5.67 1.5 1.5S10.33 8 9.5 8zm5 0c-.83 0-1.5-.67-1.5-1.5S13.67 5 14.5 5s1.5.67 1.5 1.5S15.33 8 14.5 8zm3 4c-.83 0-1.5-.67-1.5-1.5S16.67 9 17.5 9s1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"/></svg>';let d=document.createElement("div");d.className="yeditor-dropdown-content yeditor-color-grid",a.forEach(c=>{let r=document.createElement("button");r.className="yeditor-color-swatch",r.dataset.command="foreColor",r.dataset.value=c,r.style.backgroundColor=c,r.title=c,d.appendChild(r)}),l.append(u,d),e.appendChild(l);let f={justifyLeft:{title:"alignLeft",icon:'<svg viewBox="0 0 24 24"><path d="M15 15H3v2h12zm0-8H3v2h12zM3 13h18v-2H3zm0 8h18v-2H3zM3 3v2h18V3z"/></svg>'},justifyCenter:{title:"alignCenter",icon:'<svg viewBox="0 0 24 24"><path d="M7 15v2h10v-2zm-4 6h18v-2H3zm0-8h18v-2H3zm4-6v2h10V7zM3 3v2h18V3z"/></svg>'},justifyRight:{title:"alignRight",icon:'<svg viewBox="0 0 24 24"><path d="M3 21h18v-2H3zm6-4h12v-2H9zM3 13h18v-2H3zm6-4h12V7H9zM3 3v2h18V3z"/></svg>'}},m=document.createElement("div");m.className="yeditor-dropdown",m.dataset.group="align";let p=document.createElement("button"),h=this.config.direction==="rtl"?"justifyRight":"justifyLeft";p.innerHTML=f[h].icon,p.title=this.t(f[h].title);let v=document.createElement("div");return v.className="yeditor-dropdown-content",Object.entries(f).forEach(([c,r])=>{let b=document.createElement("button");b.dataset.command=c,b.title=this.t(r.title),b.innerHTML=r.icon,v.appendChild(b)}),m.append(p,v),e.appendChild(m),this._addCustomButtons(e),[{command:"setDirection",value:"ltr",title:"setDirectionLtr",icon:'<svg viewBox="0 0 24 24"><path d="M9 10v5h2V4h2v11h2V4h2V2H9C6.79 2 5 3.79 5 6s1.79 4 4 4zm12 8-4-4v3H5v2h12v3z"/></svg>'},{command:"setDirection",value:"rtl",title:"setDirectionRtl",icon:'<svg viewBox="0 0 24 24"><path d="M10 10v5h2V4h2v11h2V4h2V2h-8C7.79 2 6 3.79 6 6s1.79 4 4 4zm-2 7v-3l-4 4 4 4v-3h12v-2z"/></svg>'}].forEach(c=>{let r=document.createElement("button");r.type="button",r.dataset.command=c.command,r.dataset.value=c.value,r.title=this.t(c.title),r.innerHTML=c.icon,e.appendChild(r)}),e},createContentArea:function(e,o){let t=document.createElement("div");return t.className="yeditor-content",t.contentEditable=!0,t.dir=o,t.innerHTML=DOMPurify.sanitize(e),t},setupEventListeners:function(e,o,t,n,s){e.addEventListener("click",i=>{i.target.closest(".yeditor-dropdown > button")||e.querySelectorAll(".yeditor-dropdown.active").forEach(a=>a.classList.remove("active"))}),o.addEventListener("click",i=>{let a=i.target.closest(".yeditor-dropdown");a&&(a.classList.toggle("active"),e.querySelectorAll(".yeditor-dropdown").forEach(h=>{h!==a&&h.classList.remove("active")}));let l=i.target.closest("button[data-command]");if(!l)return;this._dispatchEvent("yeditor-command-exec",{command:l.dataset.command,value:l.dataset.value});let{command:u,value:d}=l.dataset,f=l.closest(".yeditor-dropdown");f&&f.classList.remove("active");let m=e.getSelection?e.getSelection():window.getSelection(),p=m.rangeCount>0?m.getRangeAt(0):null;if(u==="createLink"){let h=p?p.startContainer.parentElement.closest("a"):null;if(h){let v={url:h.href,newWindow:h.target==="_blank"};this.showLinkPrompt(e,v).then(g=>{g&&(h.href=g.url,g.newWindow?h.target="_blank":h.removeAttribute("target"))})}else{if(!p||p.collapsed){this.showAlert(e,this.t("linkTextRequired"));return}this.showLinkPrompt(e).then(v=>{if(v&&p){m.removeAllRanges(),m.addRange(p),document.execCommand("createLink",!1,v.url);let g=m.anchorNode.parentElement.closest("a");g&&v.newWindow&&g.setAttribute("target","_blank")}})}}else if(u==="insertTable"){this.showTablePrompt(e).then(h=>{if(h&&p){m.removeAllRanges(),m.addRange(p);let v=this._createTableHTML(h.rows,h.cols);document.execCommand("insertHTML",!1,v)}});return}else if(u==="insertImage"){this.showImagePrompt(e).then(h=>{if(h&&h.url&&p){m.removeAllRanges(),m.addRange(p);let v=DOMPurify.sanitize(h.alt,{USE_PROFILES:{html:!1}});document.execCommand("insertHTML",!1,`<img src="${h.url}" alt="${v}">`)}});return}else u==="formatBlock"&&d==="blockquote"?(p?p.startContainer.parentElement.closest("blockquote"):null)?document.execCommand("formatBlock",!1,"p"):document.execCommand("formatBlock",!1,"blockquote"):u==="setDirection"?this.setBlockDirection(e,d):document.execCommand(u,!1,d||null);t.focus()}),t.addEventListener("input",()=>{n.value=DOMPurify.sanitize(t.innerHTML),this._dispatchEvent("yeditor-change",{content:n.value}),this.updateDomPath(e,t),this.updateWordCount(e,t)}),e.addEventListener("selectionchange",()=>{this.updateDomPath(e,t)}),t.addEventListener("click",i=>{this.updateDomPath(e,t);let a=i.target.closest("a"),l=i.target.closest("table"),u=i.target.closest("img");a?(this.showLinkToolbar(e,a),i.preventDefault()):this.hideLinkToolbar(e),l?this.showTableToolbar(e,l):this.hideTableToolbar(e),u?this._handleImageSelection(e,u):this._clearImageSelection(e)}),this.updateWordCount(e,t),this.updateDomPath(e,t),t.addEventListener("keyup",i=>{(i.key===" "||i.code==="Space")&&this._handleMarkdown(e)}),t.addEventListener("keydown",i=>{i.key==="Tab"&&this._handleTabInTable(i)}),t.addEventListener("focus",()=>{this._dispatchEvent("yeditor-focus")}),t.addEventListener("blur",()=>{this._dispatchEvent("yeditor-blur")})},showAlert:function(e,o){let t=document.createElement("p");t.textContent=o;let n=document.createElement("div"),s=document.createElement("button");s.textContent=this.t("ok"),s.className="active",n.appendChild(s);let i=this._createModal(this.t("alertTitle"),t,n);requestAnimationFrame(()=>s.focus()),s.onclick=()=>i.remove()},showTablePrompt:function(e,o={}){return new Promise(t=>{let n=document.createElement("div");n.innerHTML=`
                <div class="input-group">
                    <div>
                        <label for="table-rows">${this.t("rows")}</label>
                        <input type="number" id="table-rows" min="1">
                    </div>
                    <div>
                        <label for="table-cols">${this.t("columns")}</label>
                        <input type="number" id="table-cols" min="1">
                    </div>
                </div>
                <div class="checkbox-container">
                    <input type="checkbox" id="table-header">
                    <label for="table-header">${this.t("headerRow")}</label>
                </div>
            `;let s=document.createElement("div"),i=document.createElement("button");i.textContent=this.t("cancel");let a=document.createElement("button");a.textContent=this.t("ok"),a.className="active",s.append(i,a);let l=this._createModal(this.t("table"),n,s),u=n.querySelector("#table-rows"),d=n.querySelector("#table-cols"),f=n.querySelector("#table-header");u.value=o.rows||2,d.value=o.cols||2,f.checked=o.header||!1,requestAnimationFrame(()=>u.focus()),[u,d].forEach(m=>{m.addEventListener("keydown",p=>{p.key==="Enter"&&(p.preventDefault(),a.click())})}),a.onclick=()=>{l.remove(),t({rows:parseInt(u.value,10),cols:parseInt(d.value,10),header:f.checked})},i.onclick=()=>{l.remove(),t(null)}})},showImagePrompt:function(e,o={}){return new Promise(t=>{let n=document.createElement("div");n.innerHTML=`
                <div class="yeditor-modal-tabs">
                    <button class="active" data-tab="url">${this.t("fromUrl")}</button>
                    <button data-tab="gallery">${this.t("fromGallery")}</button>
                </div>
                <div id="tab-url" class="yeditor-modal-tab-content active">
                    <label for="image-url">${this.t("linkUrlLabel")}</label>
                    <div class="input-with-button">
                        <input type="text" id="image-url" placeholder="https://..." value="${o.url||""}">
                        <button type="button" id="yeditor-browse-server" class="yeditor-browse-button">${this.t("browseServer")}</button>
                    </div>
                </div>
                <div id="tab-gallery" class="yeditor-modal-tab-content">
                    <div class="image-gallery"></div>
                </div>
                <div style="margin-top: 15px;">
                    <label for="image-alt">${this.t("altText")}</label>
                    <input type="text" id="image-alt" value="${o.alt||""}">
                </div>
            `;let s=document.createElement("div"),i=document.createElement("button");i.textContent=this.t("cancel");let a=document.createElement("button");a.textContent=this.t("ok"),a.className="active",s.append(i,a);let l=this._createModal(this.t("insertImage"),n,s);requestAnimationFrame(()=>n.querySelector("#image-url").focus());let u=n.querySelector("#image-url"),d=n.querySelector("#image-alt"),f=n.querySelector("#yeditor-browse-server");this.config.fileBrowserUrl?f.addEventListener("click",()=>{window.yEditorFileBrowserCallback=y=>{y&&(u.value=y),delete window.yEditorFileBrowserCallback};let c=this.config.fileBrowserOptions||{},r=c.width||900,b=c.height||600,w=c.left!==void 0?c.left:(window.screen.width-r)/2,L=c.top!==void 0?c.top:(window.screen.height-b)/2;window.open(this.config.fileBrowserUrl,"yEditorFileBrowser",`width=${r},height=${b},left=${w},top=${L},resizable=yes,scrollbars=yes`)}):f.style.display="none",[u,d].forEach(c=>{c.addEventListener("keydown",r=>{r.key==="Enter"&&(r.preventDefault(),a.click())})});let m=n.querySelectorAll(".yeditor-modal-tabs button"),p=n.querySelectorAll(".yeditor-modal-tab-content");m.forEach(c=>{c.addEventListener("click",()=>{m.forEach(r=>r.classList.remove("active")),c.classList.add("active"),p.forEach(r=>r.classList.remove("active")),n.querySelector(`#tab-${c.dataset.tab}`).classList.add("active")})});let h=n.querySelector(".image-gallery"),v=n.querySelector('button[data-tab="gallery"]');this.config.imageGalleryApiUrl?fetch(this.config.imageGalleryApiUrl).then(c=>c.json()).then(c=>{h.innerHTML=c.map(r=>`
                            <div class="image-gallery-item" data-url="${r.url}" data-title="${r.title}">
                                <img src="${r.url}" alt="${r.title}">
                            </div>
                        `).join("")}):v.style.display="none";let g="";h.addEventListener("click",c=>{let r=c.target.closest(".image-gallery-item");r&&(h.querySelectorAll(".image-gallery-item").forEach(b=>b.classList.remove("selected")),r.classList.add("selected"),g=r.dataset.url,n.querySelector("#image-alt").value=r.dataset.title)}),a.onclick=()=>{let r=n.querySelector(".yeditor-modal-tabs button.active").dataset.tab==="gallery"?g:n.querySelector("#image-url").value,b=n.querySelector("#image-alt").value;l.remove(),t({url:r,alt:b})},i.onclick=()=>{l.remove(),t(null)}})},showLinkPrompt:function(e,o={}){return new Promise(t=>{let n=this.config.quickLinksApiUrl?this.t("linkPlaceholder"):this.t("linkPlaceholderSimple"),s=document.createElement("div");s.innerHTML=`
                <label for="link-url">${this.t("linkUrlLabel")}</label>
                <input type="text" id="link-url" placeholder="${n}" autocomplete="off">
                <div class="search-results"></div>
                <div class="checkbox-container">
                    <input type="checkbox" id="link-new-window">
                    <label for="link-new-window">${this.t("linkNewWindowLabel")}</label>
                </div>
            `;let i=document.createElement("div"),a=document.createElement("button");a.textContent=this.t("cancel");let l=document.createElement("button");l.textContent=this.t("ok"),l.className="active",i.append(a,l);let u=this._createModal(this.t("linkPromptTitle"),s,i),d=s.querySelector("#link-url"),f=s.querySelector("#link-new-window"),m=s.querySelector(".search-results");d.value=o.url||"",f.checked=o.newWindow||!1,requestAnimationFrame(()=>{d.focus(),d.select()});let p=h=>{u.remove(),t(h)};if(l.onclick=()=>p({url:d.value,newWindow:f.checked}),a.onclick=()=>p(null),d.addEventListener("keydown",h=>{if(h.key==="Enter"){h.preventDefault();let g=m.querySelector(".selected");g?g.click():l.click();return}let v=m.querySelectorAll(".search-result-item");if(v.length>0&&(h.key==="ArrowDown"||h.key==="ArrowUp")){h.preventDefault();let g=m.querySelector(".selected"),c=-1;g&&(c=Array.from(v).indexOf(g),g.classList.remove("selected"));let r;h.key==="ArrowDown"?r=(c+1)%v.length:r=(c-1+v.length)%v.length;let b=v[r];b&&(b.classList.add("selected"),b.scrollIntoView({block:"nearest"}))}}),this.config.quickLinksApiUrl){let h;d.addEventListener("input",()=>{clearTimeout(h),h=setTimeout(async()=>{let v=d.value.trim().toLowerCase();if(v.length<2){m.innerHTML="";return}try{let r=(await(await fetch(this.config.quickLinksApiUrl)).json()).filter(b=>b.title.toLowerCase().includes(v)||b.url.toLowerCase().includes(v));m.innerHTML=r.map(b=>`<a class="search-result-item" data-url="${b.url}">
                                    ${b.title}
                                    <small>${b.url}</small>
                                </a>`).join("")}catch(g){console.error("Quick links API error:",g)}},300)})}m.addEventListener("click",h=>{let v=h.target.closest(".search-result-item");v&&(d.value=v.dataset.url,m.innerHTML="",d.focus())})})},_createModal:function(e,o,t){let n=document.createElement("div");n.className="yeditor-modal-overlay";let s=document.createElement("div");s.className="yeditor-modal";let i=document.createElement("div");i.className="yeditor-modal-header",i.textContent=e;let a=document.createElement("div");a.className="yeditor-modal-body",a.appendChild(o);let l=document.createElement("div");return l.className="yeditor-modal-footer",l.appendChild(t),s.append(i,a,l),n.appendChild(s),this._injectModalStyles(),document.body.appendChild(n),requestAnimationFrame(()=>n.classList.add("active")),n},_createTableHTML:function(e,o,t){let n="<table>";if(t){n+="<thead><tr>";for(let s=0;s<o;s++)n+="<th>&nbsp;</th>";n+="</tr></thead>",e--}if(n+="<tbody>",e>0)for(let s=0;s<e;s++){n+="<tr>";for(let i=0;i<o;i++)n+="<td>&nbsp;</td>";n+="</tr>"}return n+="</tbody></table><p><br></p>",n},_injectModalStyles:function(){if(document.getElementById("yeditor-modal-styles"))return;let e=document.createElement("style");e.id="yeditor-modal-styles";let o=this._cssContent.substring(this._cssContent.indexOf("/* --- Modal (Popup) Styles --- */"));e.textContent=o.replace(/:host\(\[data-theme="dark"\]\)/g,'body[data-yeditor-theme="dark"]'),document.head.appendChild(e)},showLinkToolbar:function(e,o){this.hideLinkToolbar(e);let t=document.createElement("div");t.className="link-toolbar";let n=document.createElement("a");n.href=o.href,n.textContent=o.href,n.target="_blank",n.rel="noopener noreferrer";let s=document.createElement("button");s.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>',s.title=this.t("linkPromptTitle");let i=document.createElement("button");i.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M16 13h-2.55v-2H16v2zm-6.45 0H7v-2h2.55v2zM17 7h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1 0 1.43-.98 2.63-2.31 2.96l1.46 1.46C20.88 15.61 22 13.95 22 12c0-2.76-2.24-5-5-5zM7 9h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1S5.29 9 7 9zm5 10c2.76 0 5-2.24 5-5h-1.9c0 1.71-1.39 3.1-3.1 3.1s-3.1-1.39-3.1-3.1H7c0 2.76 2.24 5 5 5z"/><path d="M3.41 4.83L2 6.24l18 18 1.41-1.41z"/></svg>',i.title=this.t("unlink"),t.append(n,s,i),e.appendChild(t),requestAnimationFrame(()=>{let a=o.getBoundingClientRect(),l=e.host.getBoundingClientRect(),u=a.top-l.top-t.offsetHeight-5,d=a.left-l.left+a.width/2;t.style.top=`${u}px`,t.style.left=`${d}px`,t.classList.add("active")}),s.onclick=()=>{let a={url:o.href,newWindow:o.target==="_blank"};this.showLinkPrompt(e,a).then(l=>{l&&(o.href=l.url,l.newWindow?o.target="_blank":o.removeAttribute("target"))}),this.hideLinkToolbar(e)},i.onclick=()=>{let a=e.getSelection?e.getSelection():window.getSelection(),l=document.createRange();l.selectNode(o),a.removeAllRanges(),a.addRange(l),document.execCommand("unlink",!1,null),this.hideLinkToolbar(e)}},hideLinkToolbar:function(e){let o=e.querySelector(".link-toolbar");o&&o.remove()},showTableToolbar:function(e,o){this.hideTableToolbar(e);let t=document.createElement("div");t.className="table-toolbar";let n=document.createElement("button");n.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M22 13h-8v-2h8v2zm0-6h-8v2h8V7zm-8 10h8v-2h-8v2zM12 7v10H4V7h8zm-2 8H6v-2h4v2zm0-4H6v-2h4v2z"/></svg>',n.title=this.t("addRow");let s=document.createElement("button");s.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>',s.title=this.t("editTable"),t.append(s,n),e.appendChild(t),requestAnimationFrame(()=>{let i=o.getBoundingClientRect(),a=e.host.getBoundingClientRect(),l=i.top-a.top-t.offsetHeight-5,u=i.left-a.left+i.width/2;t.style.top=`${l}px`,t.style.left=`${u}px`,t.classList.add("active")}),n.onclick=()=>{let i=o.querySelector("tbody");if(!i)return;let a=i.insertRow(-1),l=o.rows[0]?.cells.length||1;for(let u=0;u<l;u++)a.insertCell(u).innerHTML="&nbsp;"},s.onclick=()=>{let i={rows:o.rows.length,cols:o.rows[0]?.cells.length||0,header:!!o.querySelector("thead")};this.showTablePrompt(e,i).then(a=>{if(a){let l=this._createTableHTML(a.rows,a.cols,a.header),u=document.createElement("div");u.innerHTML=l;let d=DOMPurify.sanitize(u.innerHTML,{ADD_TAGS:["table","thead","tbody","tr","th","td"],ADD_ATTR:["style","border"]});o.parentNode.replaceChild(d,o)}}),this.hideTableToolbar(e)}},hideTableToolbar:function(e){let o=e.querySelector(".table-toolbar");o&&o.remove()},_handleImageSelection:function(e,o){this._clearImageSelection(e);let t=o.parentElement;t.classList.contains("yeditor-image-wrapper")||(t=document.createElement("span"),t.className="yeditor-image-wrapper",o.parentNode.insertBefore(t,o),t.appendChild(o)),t.classList.add("resizable"),t.style.width=`${o.offsetWidth}px`,t.style.height=`${o.offsetHeight}px`,this.showImageToolbar(e,t,o);let n=()=>{o.style.width=t.style.width,o.style.height=t.style.height,t.classList.remove("resizable"),this._textarea.value=DOMPurify.sanitize(t.closest(".yeditor-content").innerHTML),t.classList.add("resizable"),document.removeEventListener("mouseup",n)};document.addEventListener("mouseup",n)},_clearImageSelection:function(e){e.querySelectorAll(".yeditor-image-wrapper.resizable").forEach(o=>{o.classList.remove("resizable")}),this.hideImageToolbar(e)},showImageToolbar:function(e,o,t){this.hideImageToolbar(e);let n=document.createElement("div");n.className="image-toolbar";let s=document.createElement("button");s.innerHTML='<svg viewBox="0 0 24 24"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.996.996 0 0 0-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>',s.title=this.t("editImage");let i=document.createElement("button");i.innerHTML='<svg viewBox="0 0 24 24"><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"/></svg>',i.title=this.t("deleteImage"),n.append(s,i),e.appendChild(n),requestAnimationFrame(()=>{let a=o.getBoundingClientRect(),l=e.host.getBoundingClientRect();n.style.top=`${a.top-l.top-n.offsetHeight-5}px`,n.style.left=`${a.left-l.left+a.width/2}px`,n.classList.add("active")}),s.onclick=()=>{this.showImagePrompt(e,{url:t.src,alt:t.alt}).then(a=>{a&&(t.src=a.url,t.alt=a.alt)})},i.onclick=()=>{o.remove(),this.hideImageToolbar(e),e.querySelector(".yeditor-content").dispatchEvent(new Event("input",{bubbles:!0,cancelable:!0}))}},hideImageToolbar:function(e){let o=e.querySelector(".image-toolbar");o&&o.remove()},_handleTabInTable:function(e){let o=this._shadowRoot.getSelection();if(!o||!o.rangeCount)return;let t=o.anchorNode.parentElement.closest("td, th");if(!t)return;e.preventDefault();let n=t.closest("table"),s=Array.from(n.querySelectorAll("td, th")),i=s.indexOf(t),a;if(e.shiftKey){if(a=i-1,a<0)return}else if(a=i+1,a>=s.length){let d=(n.querySelector("tbody")||n).insertRow(-1),f=t.parentElement.cells.length;for(let m=0;m<f;m++)d.insertCell(m).innerHTML="&nbsp;";this._focusCell(d.cells[0]);return}let l=s[a];l&&this._focusCell(l)},_focusCell:function(e){let o=document.createRange(),t=this._shadowRoot.getSelection();o.selectNodeContents(e),t.removeAllRanges(),t.addRange(o)},_handleMarkdown:function(e){let o=e.getSelection();if(!o||!o.rangeCount)return;let t=o.getRangeAt(0),n=t.startContainer;if(n.nodeType!==Node.TEXT_NODE||t.startOffset<2)return;let s=n.parentElement;if(s.tagName!=="P"&&!s.tagName.startsWith("H"))return;let a=n.textContent.substring(0,t.startOffset).match(/^(#{1,6})\s$/);if(a){let u=`h${a[1].length}`,d=document.createRange();d.setStart(n,0),d.setEnd(n,a[0].length),o.removeAllRanges(),o.addRange(d),document.execCommand("insertText",!1,""),document.execCommand("formatBlock",!1,u)}},updateWordCount:function(e,o){let t=e.querySelector(".yeditor-word-count");if(!t)return;let i=(o.innerText||"").trim().split(/\s+/).filter(Boolean).length;t.textContent=`${this.t("words")||"Words"}: ${i}`},updateDomPath:function(e,o){let t=e.querySelector(".yeditor-dom-path");if(!t)return;let n=e.getSelection?e.getSelection():window.getSelection();if(!n||n.rangeCount===0)return;let s=n.anchorNode,i=[];for(;s&&s!==o;)s.nodeType===Node.ELEMENT_NODE&&i.unshift(`<span>${s.tagName.toLowerCase()}</span>`),s=s.parentNode;t.innerHTML=i.join("")},setBlockDirection:function(e,o){let t=e.getSelection?e.getSelection():window.getSelection();if(!t.rangeCount)return;let s=t.getRangeAt(0).startContainer;for(;s&&(!s.style||window.getComputedStyle(s).display!=="block");)s=s.parentNode;s&&s.style&&(s.setAttribute("dir",o),s.style.textAlign=o==="rtl"?"right":"left")},_showCustomBubble:function(e,o,t){e.querySelectorAll("[data-bubble-for]").forEach(i=>i.remove());let n=document.createElement("div");n.className="link-toolbar",n.dataset.bubbleFor=t.edit.selector;let s=document.createElement("button");s.innerHTML='<svg viewBox="0 0 24 24"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.996.996 0 0 0-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>',s.title=t.prompt.title,n.appendChild(s),e.appendChild(n),requestAnimationFrame(()=>{let i=o.getBoundingClientRect(),a=e.host.getBoundingClientRect();n.style.top=`${i.top-a.top-n.offsetHeight-5}px`,n.style.left=`${i.left-a.left+i.width/2}px`,n.classList.add("active")}),s.onclick=()=>{let i=t.edit.onOpen(o);this._showCustomPrompt(t.prompt,i).then(a=>{if(a){let l=t.onInsert(a),u=document.createElement("div");u.innerHTML=l;let d=u.firstElementChild;o.parentNode.replaceChild(d,o)}}),n.remove()}},_customButtons:[],registerButton:function(e){this._customButtons.push(e)},_addCustomButtons:function(e){this._customButtons.forEach(o=>{let t=document.createElement("button");t.type="button",t.title=o.title,t.innerHTML=o.icon,t.addEventListener("click",()=>{let n=this._shadowRoot.getSelection(),s=n.rangeCount>0?n.getRangeAt(0):null;this._showCustomPrompt(o.prompt,{}).then(i=>{if(!(!i||Array.isArray(i)&&i.length===0)&&s){n.removeAllRanges(),n.addRange(s);let a=Array.isArray(i)?i:[i],l=o.onInsert(a),u=DOMPurify.sanitize(l,{ADD_ATTR:["style"]});document.execCommand("insertHTML",!1,u)}})}),e.appendChild(t)})},_showCustomPrompt:function(e,o={}){return new Promise(t=>{let n=document.createElement("div"),s=e.multiple===!0;s&&(n.innerHTML+='<div class="selected-items-container"></div>'),n.innerHTML=`
                <label for="custom-search">${e.label}</label>
                <input type="text" id="custom-search" placeholder="${e.placeholder}" autocomplete="off">
                <div class="search-results"></div>
            `;let i=document.createElement("div"),a=document.createElement("button");a.textContent=this.t("cancel");let l=document.createElement("button");l.textContent=this.t("ok"),l.className="active",i.append(a,l);let u=this._createModal(e.title,n,i),d=n.querySelector("#custom-search");requestAnimationFrame(()=>d.focus());let f=n.querySelector(".search-results"),m=n.querySelector(".selected-items-container"),p=[];d.value=o[e.displayField]||"",d.addEventListener("keydown",v=>{v.key==="Enter"&&(v.preventDefault(),l.click())});let h=()=>{m&&(m.innerHTML=p.map((v,g)=>`
                    <span class="selected-item" data-index="${g}">
                        ${v[e.displayField]}
                        <button type="button" class="selected-item-remove" title="Remove">&times;</button>
                    </span>
                `).join(""))};m&&m.addEventListener("click",v=>{if(v.target.classList.contains("selected-item-remove")){let g=v.target.closest(".selected-item"),c=parseInt(g.dataset.index,10);p.splice(c,1),h()}}),d.addEventListener("input",async()=>{let v=d.value.trim().toLowerCase();if(v.length<2){f.innerHTML="";return}let g=await e.search(v);f.innerHTML=g.map(c=>e.renderItem(c)).join("")}),f.addEventListener("click",v=>{let g=v.target.closest("[data-item]");if(!g)return;let c=JSON.parse(g.dataset.item);s?(p.some(r=>r.id===c.id)||(p.push(c),h()),d.value="",f.innerHTML="",d.focus()):(p=[c],d.value=c[e.displayField],f.innerHTML="")}),l.onclick=()=>{u.remove(),t(s?p:p[0]||null)},a.onclick=()=>{u.remove(),t(null)}})},_dispatchEvent:function(e,o={}){this._container&&this._container.dispatchEvent(new CustomEvent(e,{bubbles:!0,composed:!0,detail:o}))}};window.yEditor=k;})();
